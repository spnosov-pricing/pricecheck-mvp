This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.gitignore
eslint.config.js
index.html
package.json
postcss.config.js
public/vite.svg
README.md
src/App.css
src/App.tsx
src/assets/react.svg
src/components/Common/Loader.tsx
src/components/Forms/CSVUploader.tsx
src/components/Forms/QuickInputForm.tsx
src/components/Results/AnomalyTable.tsx
src/components/Results/PaywallModal.tsx
src/components/Results/RevenueChart.tsx
src/core/elasticity.ts
src/core/inflation.ts
src/core/ltv.ts
src/core/pricing.ts
src/core/types.ts
src/csv/anomaly.ts
src/csv/parser.ts
src/csv/types.ts
src/csv/validator.ts
src/hooks/useCSVParser.ts
src/hooks/usePricingCalculations.ts
src/index.css
src/main.tsx
src/store/appStore.ts
src/store/types.ts
tsconfig.app.json
tsconfig.json
tsconfig.node.json
vite.config.ts
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".gitignore">
# Logs
logs
*.log
npm-debug.log*
yarn-debug.log*
yarn-error.log*
pnpm-debug.log*
lerna-debug.log*

node_modules
dist
dist-ssr
*.local

# Editor directories and files
.vscode/*
!.vscode/extensions.json
.idea
.DS_Store
*.suo
*.ntvs*
*.njsproj
*.sln
*.sw?
</file>

<file path="eslint.config.js">
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import tseslint from 'typescript-eslint'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      js.configs.recommended,
      tseslint.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
    },
  },
])
</file>

<file path="index.html">
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pricecheck-mvp</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.tsx"></script>
  </body>
</html>
</file>

<file path="public/vite.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="31.88" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 257"><defs><linearGradient id="IconifyId1813088fe1fbc01fb466" x1="-.828%" x2="57.636%" y1="7.652%" y2="78.411%"><stop offset="0%" stop-color="#41D1FF"></stop><stop offset="100%" stop-color="#BD34FE"></stop></linearGradient><linearGradient id="IconifyId1813088fe1fbc01fb467" x1="43.376%" x2="50.316%" y1="2.242%" y2="89.03%"><stop offset="0%" stop-color="#FFEA83"></stop><stop offset="8.333%" stop-color="#FFDD35"></stop><stop offset="100%" stop-color="#FFA800"></stop></linearGradient></defs><path fill="url(#IconifyId1813088fe1fbc01fb466)" d="M255.153 37.938L134.897 252.976c-2.483 4.44-8.862 4.466-11.382.048L.875 37.958c-2.746-4.814 1.371-10.646 6.827-9.67l120.385 21.517a6.537 6.537 0 0 0 2.322-.004l117.867-21.483c5.438-.991 9.574 4.796 6.877 9.62Z"></path><path fill="url(#IconifyId1813088fe1fbc01fb467)" d="M185.432.063L96.44 17.501a3.268 3.268 0 0 0-2.634 3.014l-5.474 92.456a3.268 3.268 0 0 0 3.997 3.378l24.777-5.718c2.318-.535 4.413 1.507 3.936 3.838l-7.361 36.047c-.495 2.426 1.782 4.5 4.151 3.78l15.304-4.649c2.372-.72 4.652 1.36 4.15 3.788l-11.698 56.621c-.732 3.542 3.979 5.473 5.943 2.437l1.313-2.028l72.516-144.72c1.215-2.423-.88-5.186-3.54-4.672l-25.505 4.922c-2.396.462-4.435-1.77-3.759-4.114l16.646-57.705c.677-2.35-1.37-4.583-3.769-4.113Z"></path></svg>
</file>

<file path="README.md">
# React + TypeScript + Vite

This template provides a minimal setup to get React working in Vite with HMR and some ESLint rules.

Currently, two official plugins are available:

- [@vitejs/plugin-react](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react) uses [Babel](https://babeljs.io/) (or [oxc](https://oxc.rs) when used in [rolldown-vite](https://vite.dev/guide/rolldown)) for Fast Refresh
- [@vitejs/plugin-react-swc](https://github.com/vitejs/vite-plugin-react/blob/main/packages/plugin-react-swc) uses [SWC](https://swc.rs/) for Fast Refresh

## React Compiler

The React Compiler is not enabled on this template because of its impact on dev & build performances. To add it, see [this documentation](https://react.dev/learn/react-compiler/installation).

## Expanding the ESLint configuration

If you are developing a production application, we recommend updating the configuration to enable type-aware lint rules:

```js
export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // Other configs...

      // Remove tseslint.configs.recommended and replace with this
      tseslint.configs.recommendedTypeChecked,
      // Alternatively, use this for stricter rules
      tseslint.configs.strictTypeChecked,
      // Optionally, add this for stylistic rules
      tseslint.configs.stylisticTypeChecked,

      // Other configs...
    ],
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.node.json', './tsconfig.app.json'],
        tsconfigRootDir: import.meta.dirname,
      },
      // other options...
    },
  },
])
```

You can also install [eslint-plugin-react-x](https://github.com/Rel1cx/eslint-react/tree/main/packages/plugins/eslint-plugin-react-x) and [eslint-plugin-react-dom](https://github.com/Rel1cx/eslint-react/tree/main/packages/plugins/eslint-plugin-react-dom) for React-specific lint rules:

```js
// eslint.config.js
import reactX from 'eslint-plugin-react-x'
import reactDom from 'eslint-plugin-react-dom'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{ts,tsx}'],
    extends: [
      // Other configs...
      // Enable lint rules for React
      reactX.configs['recommended-typescript'],
      // Enable lint rules for React DOM
      reactDom.configs.recommended,
    ],
    languageOptions: {
      parserOptions: {
        project: ['./tsconfig.node.json', './tsconfig.app.json'],
        tsconfigRootDir: import.meta.dirname,
      },
      // other options...
    },
  },
])
```
</file>

<file path="src/App.css">
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}
</file>

<file path="src/assets/react.svg">
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="35.93" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 228"><path fill="#00D8FF" d="M210.483 73.824a171.49 171.49 0 0 0-8.24-2.597c.465-1.9.893-3.777 1.273-5.621c6.238-30.281 2.16-54.676-11.769-62.708c-13.355-7.7-35.196.329-57.254 19.526a171.23 171.23 0 0 0-6.375 5.848a155.866 155.866 0 0 0-4.241-3.917C100.759 3.829 77.587-4.822 63.673 3.233C50.33 10.957 46.379 33.89 51.995 62.588a170.974 170.974 0 0 0 1.892 8.48c-3.28.932-6.445 1.924-9.474 2.98C17.309 83.498 0 98.307 0 113.668c0 15.865 18.582 31.778 46.812 41.427a145.52 145.52 0 0 0 6.921 2.165a167.467 167.467 0 0 0-2.01 9.138c-5.354 28.2-1.173 50.591 12.134 58.266c13.744 7.926 36.812-.22 59.273-19.855a145.567 145.567 0 0 0 5.342-4.923a168.064 168.064 0 0 0 6.92 6.314c21.758 18.722 43.246 26.282 56.54 18.586c13.731-7.949 18.194-32.003 12.4-61.268a145.016 145.016 0 0 0-1.535-6.842c1.62-.48 3.21-.974 4.76-1.488c29.348-9.723 48.443-25.443 48.443-41.52c0-15.417-17.868-30.326-45.517-39.844Zm-6.365 70.984c-1.4.463-2.836.91-4.3 1.345c-3.24-10.257-7.612-21.163-12.963-32.432c5.106-11 9.31-21.767 12.459-31.957c2.619.758 5.16 1.557 7.61 2.4c23.69 8.156 38.14 20.213 38.14 29.504c0 9.896-15.606 22.743-40.946 31.14Zm-10.514 20.834c2.562 12.94 2.927 24.64 1.23 33.787c-1.524 8.219-4.59 13.698-8.382 15.893c-8.067 4.67-25.32-1.4-43.927-17.412a156.726 156.726 0 0 1-6.437-5.87c7.214-7.889 14.423-17.06 21.459-27.246c12.376-1.098 24.068-2.894 34.671-5.345a134.17 134.17 0 0 1 1.386 6.193ZM87.276 214.515c-7.882 2.783-14.16 2.863-17.955.675c-8.075-4.657-11.432-22.636-6.853-46.752a156.923 156.923 0 0 1 1.869-8.499c10.486 2.32 22.093 3.988 34.498 4.994c7.084 9.967 14.501 19.128 21.976 27.15a134.668 134.668 0 0 1-4.877 4.492c-9.933 8.682-19.886 14.842-28.658 17.94ZM50.35 144.747c-12.483-4.267-22.792-9.812-29.858-15.863c-6.35-5.437-9.555-10.836-9.555-15.216c0-9.322 13.897-21.212 37.076-29.293c2.813-.98 5.757-1.905 8.812-2.773c3.204 10.42 7.406 21.315 12.477 32.332c-5.137 11.18-9.399 22.249-12.634 32.792a134.718 134.718 0 0 1-6.318-1.979Zm12.378-84.26c-4.811-24.587-1.616-43.134 6.425-47.789c8.564-4.958 27.502 2.111 47.463 19.835a144.318 144.318 0 0 1 3.841 3.545c-7.438 7.987-14.787 17.08-21.808 26.988c-12.04 1.116-23.565 2.908-34.161 5.309a160.342 160.342 0 0 1-1.76-7.887Zm110.427 27.268a347.8 347.8 0 0 0-7.785-12.803c8.168 1.033 15.994 2.404 23.343 4.08c-2.206 7.072-4.956 14.465-8.193 22.045a381.151 381.151 0 0 0-7.365-13.322Zm-45.032-43.861c5.044 5.465 10.096 11.566 15.065 18.186a322.04 322.04 0 0 0-30.257-.006c4.974-6.559 10.069-12.652 15.192-18.18ZM82.802 87.83a323.167 323.167 0 0 0-7.227 13.238c-3.184-7.553-5.909-14.98-8.134-22.152c7.304-1.634 15.093-2.97 23.209-3.984a321.524 321.524 0 0 0-7.848 12.897Zm8.081 65.352c-8.385-.936-16.291-2.203-23.593-3.793c2.26-7.3 5.045-14.885 8.298-22.6a321.187 321.187 0 0 0 7.257 13.246c2.594 4.48 5.28 8.868 8.038 13.147Zm37.542 31.03c-5.184-5.592-10.354-11.779-15.403-18.433c4.902.192 9.899.29 14.978.29c5.218 0 10.376-.117 15.453-.343c-4.985 6.774-10.018 12.97-15.028 18.486Zm52.198-57.817c3.422 7.8 6.306 15.345 8.596 22.52c-7.422 1.694-15.436 3.058-23.88 4.071a382.417 382.417 0 0 0 7.859-13.026a347.403 347.403 0 0 0 7.425-13.565Zm-16.898 8.101a358.557 358.557 0 0 1-12.281 19.815a329.4 329.4 0 0 1-23.444.823c-7.967 0-15.716-.248-23.178-.732a310.202 310.202 0 0 1-12.513-19.846h.001a307.41 307.41 0 0 1-10.923-20.627a310.278 310.278 0 0 1 10.89-20.637l-.001.001a307.318 307.318 0 0 1 12.413-19.761c7.613-.576 15.42-.876 23.31-.876H128c7.926 0 15.743.303 23.354.883a329.357 329.357 0 0 1 12.335 19.695a358.489 358.489 0 0 1 11.036 20.54a329.472 329.472 0 0 1-11 20.722Zm22.56-122.124c8.572 4.944 11.906 24.881 6.52 51.026c-.344 1.668-.73 3.367-1.15 5.09c-10.622-2.452-22.155-4.275-34.23-5.408c-7.034-10.017-14.323-19.124-21.64-27.008a160.789 160.789 0 0 1 5.888-5.4c18.9-16.447 36.564-22.941 44.612-18.3ZM128 90.808c12.625 0 22.86 10.235 22.86 22.86s-10.235 22.86-22.86 22.86s-22.86-10.235-22.86-22.86s10.235-22.86 22.86-22.86Z"></path></svg>
</file>

<file path="src/components/Common/Loader.tsx">
// src/components/Common/Loader.tsx
import React from 'react';

interface LoaderProps {
   size?: 'sm' | 'md' | 'lg';
   label?: string;
}

export const Loader: React.FC<LoaderProps> = ({ size = 'md', label }) => {
   // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ –∫—Ä—É—Ç–∏–ª–∫–∏
   const sizeClasses = {
      sm: 'h-4 w-4 border-2',
      md: 'h-8 w-8 border-3',
      lg: 'h-12 w-12 border-4',
   };

   return (
      <div className="flex flex-col items-center justify-center space-y-3">
         <div
            className={`
          ${sizeClasses[size]} 
          animate-spin 
          rounded-full 
          border-blue-100 
          border-t-blue-600
        `}
         />
         {label && <p className="text-sm text-gray-500 font-medium">{label}</p>}
      </div>
   );
};
</file>

<file path="src/components/Forms/CSVUploader.tsx">
// src/components/Forms/CSVUploader.tsx
import React, { useCallback, useState } from 'react';
import { useCSVParser } from '../../hooks/useCSVParser';
import { useAppStore } from '../../store/appStore';
import { Loader } from '../Common/Loader';

export const CSVUploader: React.FC = () => {
   const { parseFile, isLoading, error } = useCSVParser();
   const { setCSVData, setCSVAnalysis } = useAppStore();
   const [isDragOver, setIsDragOver] = useState(false);

   const handleFile = useCallback(async (file: File) => {
      const result = await parseFile(file);
      // @ts-ignore - –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—Ö–æ–¥—è—Ç –∏–∑ —Ö—É–∫–∞, –∫–æ—Ç–æ—Ä—ã–π –º—ã –Ω–∞–ø–∏—Å–∞–ª–∏ —Ä–∞–Ω–µ–µ
      if (result && !result.errors.length) {
         // @ts-ignore
         setCSVData(result.rows);
         // @ts-ignore
         setCSVAnalysis(result.analysis);
      }
   }, [parseFile, setCSVData, setCSVAnalysis]);

   const onDrop = (e: React.DragEvent) => {
      e.preventDefault();
      setIsDragOver(false);
      const file = e.dataTransfer.files[0];
      if (file) handleFile(file);
   };

   return (
      <div className="space-y-4">
         <div
            onDragOver={(e) => { e.preventDefault(); setIsDragOver(true); }}
            onDragLeave={() => setIsDragOver(false)}
            onDrop={onDrop}
            className={`relative border-2 border-dashed rounded-2xl p-10 transition-all flex flex-col items-center justify-center text-center
          ${isDragOver ? 'border-blue-500 bg-blue-50' : 'border-gray-300 bg-gray-50'}
          ${isLoading ? 'opacity-50 pointer-events-none' : 'hover:border-blue-400 hover:bg-white'}
        `}
         >
            <input
               type="file" accept=".csv"
               onChange={(e) => e.target.files?.[0] && handleFile(e.target.files[0])}
               className="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
            />

            {isLoading ? (
               <Loader label="–ò—â–µ–º —Å–∫—Ä—ã—Ç—É—é –ø—Ä–∏–±—ã–ª—å..." size="md" />
            ) : (
               <>
                  <div className="mb-4 p-4 bg-blue-100 rounded-full text-blue-600 text-2xl">üìä</div>
                  <h3 className="text-lg font-bold text-gray-800">–ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –≤–∞—à CSV —Ñ–∞–π–ª</h3>
                  <p className="text-sm text-gray-500 mt-2">–ú—ã –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ü–µ–Ω—ã –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –∏ –Ω–∞–π–¥–µ–º –∞–Ω–æ–º–∞–ª–∏–∏</p>
               </>
            )}
         </div>

         {error && (
            <div className="p-4 bg-red-50 border border-red-200 rounded-xl text-sm text-red-700">
               <strong>–û—à–∏–±–∫–∞:</strong> {error}
            </div>
         )}
      </div>
   );
};
</file>

<file path="src/components/Results/AnomalyTable.tsx">
// src/components/Results/AnomalyTable.tsx
import React, { useState } from 'react';
import { useAppStore } from '../../store/appStore';
import { PaywallModal } from './PaywallModal';

export const AnomalyTable: React.FC = () => {
   const { csvAnalysis } = useAppStore();
   const [showPaywall, setShowPaywall] = useState(false);

   if (!csvAnalysis || csvAnalysis.anomalies.length === 0) return null;

   const formatCurrency = (val: number) =>
      new Intl.NumberFormat('ru-RU', { style: 'currency', currency: 'RUB', maximumFractionDigits: 0 }).format(val);

   return (
      <div className="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden mt-6">
         <PaywallModal isOpen={showPaywall} onClose={() => setShowPaywall(false)} />

         <div className="p-6 border-b border-gray-100 bg-red-50 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
            <div>
               <h3 className="text-lg font-bold text-red-800 flex items-center gap-2">
                  <span>‚ö†Ô∏è</span> –ù–∞–π–¥–µ–Ω–æ –∞–Ω–æ–º–∞–ª–∏–π: {csvAnalysis.anomalyCount}
               </h3>
               <p className="text-sm text-red-600 mt-1">
                  –û–±—â–∏–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª: <span className="font-bold">{formatCurrency(csvAnalysis.potentialRecoveryTotal)}</span> –≤ –≥–æ–¥
               </p>
            </div>
            <button
               onClick={() => setShowPaywall(true)}
               className="flex items-center gap-2 bg-white border border-red-200 text-red-700 px-4 py-2 rounded-xl text-sm font-bold hover:bg-red-100 transition-colors shadow-sm"
            >
               <span>üìÑ</span> –°–∫–∞—á–∞—Ç—å PDF –æ—Ç—á–µ—Ç
            </button>
         </div>

         <div className="overflow-x-auto">
            <table className="w-full text-left text-sm">
               <thead className="bg-gray-50 text-gray-600 font-medium">
                  <tr>
                     <th className="px-6 py-3">–ö–ª–∏–µ–Ω—Ç</th>
                     <th className="px-6 py-3">–¢–µ–∫. —Ü–µ–Ω–∞</th>
                     <th className="px-6 py-3">–û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ</th>
                     <th className="px-6 py-3 text-right">–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª (–≥–æ–¥)</th>
                  </tr>
               </thead>
               <tbody className="divide-y divide-gray-100">
                  {csvAnalysis.anomalies.slice(0, 5).map((anomaly, idx) => (
                     <tr key={idx} className="hover:bg-gray-50 transition-colors">
                        <td className="px-6 py-4 font-medium text-gray-900">{anomaly.customerName}</td>
                        <td className="px-6 py-4">{formatCurrency(anomaly.currentPrice)}</td>
                        <td className="px-6 py-4">
                           <span className={`px-2 py-1 rounded-full text-xs font-bold ${anomaly.severity === 'high' ? 'bg-red-100 text-red-700' : 'bg-orange-100 text-orange-700'
                              }`}>
                              -{anomaly.deviationPercent.toFixed(0)}%
                           </span>
                        </td>
                        <td className="px-6 py-4 text-right font-bold text-green-600">
                           +{formatCurrency(anomaly.potentialRecovery)}
                        </td>
                     </tr>
                  ))}
               </tbody>
            </table>
            {csvAnalysis.anomalies.length > 5 && (
               <div className="p-4 bg-gray-50 text-center border-t border-gray-100">
                  <button onClick={() => setShowPaywall(true)} className="text-blue-600 font-bold text-xs hover:underline uppercase tracking-widest">
                     –ü–æ–∫–∞–∑–∞—Ç—å –µ—â–µ {csvAnalysis.anomalies.length - 5} –∞–Ω–æ–º–∞–ª–∏–π
                  </button>
               </div>
            )}
         </div>
      </div>
   );
};
</file>

<file path="src/components/Results/PaywallModal.tsx">
// src/components/Results/PaywallModal.tsx
import React from 'react';

interface PaywallModalProps {
   isOpen: boolean;
   onClose: () => void;
}

export const PaywallModal: React.FC<PaywallModalProps> = ({ isOpen, onClose }) => {
   if (!isOpen) return null;

   return (
      <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
         <div className="bg-white rounded-3xl max-w-md w-full overflow-hidden shadow-2xl animate-in fade-in zoom-in duration-300">
            <div className="bg-blue-600 p-8 text-center text-white relative">
               <button onClick={onClose} className="absolute top-4 right-4 text-white/80 hover:text-white text-2xl">&times;</button>
               <div className="text-5xl mb-4">üìÑ</div>
               <h3 className="text-2xl font-black">PRO –û—Ç—á–µ—Ç</h3>
               <p className="text-blue-100 mt-2">–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø—Ä–∏–±—ã–ª–∏ –≤ PDF</p>
            </div>

            <div className="p-8">
               <ul className="space-y-4 mb-8">
                  <li className="flex items-center gap-3 text-gray-700">
                     <span className="text-green-500 font-bold">‚úì</span> –ü–æ—Å—Ç—Ä–æ—á–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
                  </li>
                  <li className="flex items-center gap-3 text-gray-700">
                     <span className="text-green-500 font-bold">‚úì</span> –ì—Ä–∞—Ñ–∏–∫–∏ —ç–ª–∞—Å—Ç–∏—á–Ω–æ—Å—Ç–∏ –¥–ª—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π
                  </li>
                  <li className="flex items-center gap-3 text-gray-700">
                     <span className="text-green-500 font-bold">‚úì</span> –®–∞–±–ª–æ–Ω—ã –ø–∏—Å–µ–º –æ–± –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ —Ü–µ–Ω
                  </li>
               </ul>

               <div className="bg-gray-50 p-4 rounded-2xl mb-6 flex justify-between items-center border border-gray-100">
                  <div>
                     <p className="text-xs text-gray-500 uppercase font-bold tracking-wider">–¢–∞—Ä–∏—Ñ PRO</p>
                     <p className="text-2xl font-black text-gray-900">2 900 ‚ÇΩ <span className="text-sm font-normal text-gray-500">/ –º–µ—Å</span></p>
                  </div>
                  <div className="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-bold">-30% —Å–µ–≥–æ–¥–Ω—è</div>
               </div>

               <button
                  className="w-full bg-blue-600 text-white py-4 rounded-xl font-bold text-lg hover:bg-blue-700 transition-all shadow-lg active:scale-95"
                  onClick={() => alert('–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —ç–∫–≤–∞–π—Ä–∏–Ω–≥–æ–º –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ. –°–ø–∞—Å–∏–±–æ –∑–∞ –∏–Ω—Ç–µ—Ä–µ—Å –∫ MVP!')}
               >
                  –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —ç–∫—Å–ø–æ—Ä—Ç
               </button>
               <p className="text-center text-xs text-gray-400 mt-4">–û–ø–ª–∞—Ç–∞ –∫–∞—Ä—Ç–æ–π –†–§ / –°–ë–ü / –°—á–µ—Ç –¥–ª—è —é—Ä–ª–∏—Ü</p>
            </div>
         </div>
      </div>
   );
};
</file>

<file path="src/core/elasticity.ts">
import type { ElasticityModel } from './types';

/**
 * –ú–æ–¥–µ–ª–∏ —ç–ª–∞—Å—Ç–∏—á–Ω–æ—Å—Ç–∏ —Å–ø—Ä–æ—Å–∞ –ø–æ –æ—Ç—Ä–∞—Å–ª—è–º
 * –ò—Å—Ç–æ—á–Ω–∏–∫: McKinsey, Bain pricing studies
 */
export const ELASTICITY_MODELS: Record<string, ElasticityModel> = {
   // SaaS: –±–æ–ª–µ–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã –∫ —Ü–µ–Ω–µ, –º–Ω–æ–≥–æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
   saas_low: {
      industry: 'saas',
      priceElasticity: -0.8, // 1% —Ä–æ—Å—Ç —Ü–µ–Ω—ã = 0.8% –ø–∞–¥–µ–Ω–∏–µ —Å–ø—Ä–æ—Å–∞
      demandCurve: (price: number) => 1000 * Math.pow(price, -0.8),
   },
   saas_medium: {
      industry: 'saas',
      priceElasticity: -1.2,
      demandCurve: (price: number) => 1000 * Math.pow(price, -1.2),
   },
   saas_high: {
      industry: 'saas',
      priceElasticity: -1.8,
      demandCurve: (price: number) => 1000 * Math.pow(price, -1.8),
   },

   // Agency: —Å—Ä–µ–¥–Ω—è—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –µ—Å—Ç—å –ª–æ—è–ª—å–Ω–æ—Å—Ç—å
   agency_low: {
      industry: 'agency',
      priceElasticity: -0.6,
      demandCurve: (price: number) => 500 * Math.pow(price, -0.6),
   },
   agency_medium: {
      industry: 'agency',
      priceElasticity: -1.0,
      demandCurve: (price: number) => 500 * Math.pow(price, -1.0),
   },

   // Infrastructure: –Ω–∏–∑–∫–∞—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –≤—ã—Å–æ–∫–∏–µ switching costs
   infrastructure_low: {
      industry: 'infrastructure',
      priceElasticity: -0.4,
      demandCurve: (price: number) => 2000 * Math.pow(price, -0.4),
   },
   infrastructure_medium: {
      industry: 'infrastructure',
      priceElasticity: -0.7,
      demandCurve: (price: number) => 2000 * Math.pow(price, -0.7),
   },
};

/**
 * –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ —ç–ª–∞—Å—Ç–∏—á–Ω–æ—Å—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ç—Ä–∞—Å–ª–∏ –∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç–∏
 */
export const selectElasticityModel = (
   industry: 'saas' | 'agency' | 'infrastructure',
   competitiveness: 'low' | 'medium' | 'high'
): ElasticityModel => {
   // –ò–°–ü–†–ê–í–õ–ï–ù–û: –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–∞ —á–µ—Ä–µ–∑ —à–∞–±–ª–æ–Ω–Ω—É—é —Å—Ç—Ä–æ–∫—É
   const key = `${industry}_${competitiveness}`;
   return ELASTICITY_MODELS[key] || ELASTICITY_MODELS['saas_medium'];
};

/**
 * –†–∞—Å—á–µ—Ç –∫—Ä–∏–≤–æ–π —Å–ø—Ä–æ—Å–∞
 */
export const generateDemandCurve = (
   elasticityModel: ElasticityModel,
   priceRange: { min: number; max: number },
   steps: number = 50
): Array<{ price: number; demand: number }> => {
   const step = (priceRange.max - priceRange.min) / steps;
   const curve = [];

   for (let price = priceRange.min; price <= priceRange.max; price += step) {
      curve.push({
         price: Math.round(price * 100) / 100,
         demand: elasticityModel.demandCurve(price),
      });
   }

   return curve;
};

/**
 * –†–∞—Å—á–µ—Ç —Ç–æ—á–∫–∏ –º–∞–∫—Å–∏–º–∏–∑–∞—Ü–∏–∏ –≤—ã—Ä—É—á–∫–∏ –Ω–∞ –∫—Ä–∏–≤–æ–π —Å–ø—Ä–æ—Å–∞
 */
export const findRevenueMaximizingPrice = (
   elasticityModel: ElasticityModel,
   basePrice: number,
   priceRange: { min: number; max: number }
): { optimalPrice: number; maxRevenue: number } => {
   const curve = generateDemandCurve(elasticityModel, priceRange, 100);

   let maxRevenue = 0;
   let optimalPrice = basePrice;

   curve.forEach(({ price, demand }) => {
      const revenue = price * demand;
      if (revenue > maxRevenue) {
         maxRevenue = revenue;
         optimalPrice = price;
      }
   });

   return { optimalPrice, maxRevenue };
};

/**
 * –ê–Ω–∞–ª–∏–∑ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ü–µ–Ω—ã
 */
export const priceElasticityAnalysis = (
   basePrice: number,
   baseDemand: number,
   elasticity: number,
   priceChangePercent: number
): {
   newPrice: number;
   newDemand: number;
   revenueChange: number;
   elasticity: number;
} => {
   const newPrice = basePrice * (1 + priceChangePercent);
   const demandChange = elasticity * priceChangePercent;
   const newDemand = baseDemand * (1 + demandChange);

   const currentRevenue = basePrice * baseDemand;
   const newRevenue = newPrice * newDemand;
   const revenueChange = ((newRevenue - currentRevenue) / currentRevenue) * 100;

   return {
      newPrice,
      newDemand,
      revenueChange,
      elasticity,
   };
};
</file>

<file path="src/core/inflation.ts">
import { differenceInMonths } from 'date-fns';
// –ò–°–ü–†–ê–í–õ–ï–ù–û: –î–æ–±–∞–≤–ª–µ–Ω –ø—Ä–µ—Ñ–∏–∫—Å type –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è –ø—Ä–∞–≤–∏–ª–∞–º TS
import type { InflationImpact } from './types';

/**
 * IT-—Å–µ–∫—Ç–æ—Ä –∏–Ω—Ñ–ª—è—Ü–∏—è –ø–æ –≥–æ–¥–∞–º (–±–µ–Ω—á–º–∞—Ä–∫–∏)
 * –ò—Å—Ç–æ—á–Ω–∏–∫: McKinsey, Gartner reports
 */
const IT_INFLATION_BENCHMARKS: Record<number, number> = {
   2020: 0.02, // 2%
   2021: 0.03, // 3%
   2022: 0.08, // 8%
   2023: 0.05, // 5%
   2024: 0.04, // 4%
};

const DEFAULT_IT_INFLATION_RATE = 0.04; // 4% –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

/**
 * –†–∞—Å—á–µ—Ç –∫—É–º—É–ª—è—Ç–∏–≤–Ω–æ–π –∏–Ω—Ñ–ª—è—Ü–∏–∏ –∑–∞ –ø–µ—Ä–∏–æ–¥
 */
const calculateCumulativeInflation = (
   startDate: Date,
   endDate: Date = new Date()
): number => {
   let cumulativeInflation = 1;
   let currentDate = new Date(startDate);

   while (currentDate < endDate) {
      const year = currentDate.getFullYear();
      const rate = IT_INFLATION_BENCHMARKS[year] || DEFAULT_IT_INFLATION_RATE;

      // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–ª—è—Ü–∏—é –∑–∞ –º–µ—Å—è—Ü
      cumulativeInflation *= 1 + rate / 12;

      currentDate.setMonth(currentDate.getMonth() + 1);
   }

   return cumulativeInflation - 1;
};

/**
 * –†–∞—Å—á–µ—Ç –æ–±–µ—Å—Ü–µ–Ω–∏–≤–∞–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ MRR –∏–∑-–∑–∞ –∏–Ω—Ñ–ª—è—Ü–∏–∏
 */
export const calculateInflationImpact = (
   currentPrice: number,
   currentCustomers: number,
   lastPriceIncreaseDate: Date
   // –ò–°–ü–†–ê–í–õ–ï–ù–û: –£–¥–∞–ª–µ–Ω –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä industry –¥–ª—è —á–∏—Å—Ç–æ—Ç—ã –∫–æ–¥–∞
): InflationImpact => {
   const now = new Date();
   const monthsSincePriceIncrease = differenceInMonths(now, lastPriceIncreaseDate);

   // –†–∞—Å—á–µ—Ç –∫—É–º—É–ª—è—Ç–∏–≤–Ω–æ–π –∏–Ω—Ñ–ª—è—Ü–∏–∏
   const cumulativeInflationImpact = calculateCumulativeInflation(
      lastPriceIncreaseDate,
      now
   );

   // –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º–∞—è –Ω–æ–≤–∞—è —Ü–µ–Ω–∞
   const recommendedNewPrice = currentPrice * (1 + cumulativeInflationImpact);

   // –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—ã—Ä—É—á–∫–∏ –≤ –≥–æ–¥
   const priceIncrease = recommendedNewPrice - currentPrice;
   const potentialRecovery = priceIncrease * currentCustomers * 12;

   // –°—Ä–µ–¥–Ω—è—è –∏–Ω—Ñ–ª—è—Ü–∏—è –≤ IT-—Å–µ–∫—Ç–æ—Ä–µ –∑–∞ –ø–µ—Ä–∏–æ–¥
   const itInflationRate = cumulativeInflationImpact / (monthsSincePriceIncrease / 12);

   return {
      lastPriceIncreaseDate,
      monthsSincePriceIncrease,
      itInflationRate,
      cumulativeInflationImpact,
      recommendedNewPrice,
      potentialRecovery,
   };
};

/**
 * –†–∞—Å—á–µ—Ç "–ø–æ—Ç–µ—Ä—è–Ω–Ω—ã—Ö –¥–µ–Ω–µ–≥" –∏–∑-–∑–∞ –∏–Ω—Ñ–ª—è—Ü–∏–∏
 */
export const calculateInflationLeakage = (
   currentPrice: number,
   currentCustomers: number,
   monthsSincePriceIncrease: number,
   annualInflationRate: number = DEFAULT_IT_INFLATION_RATE
): {
   leakageMonthly: number;
   leakageAnnual: number;
   leakagePercent: number;
   recommendedPrice: number;
} => {
   const monthlyRate = annualInflationRate / 12;
   const cumulativeInflation = Math.pow(1 + monthlyRate, monthsSincePriceIncrease) - 1;

   const recommendedPrice = currentPrice * (1 + cumulativeInflation);
   const priceGap = recommendedPrice - currentPrice;

   const leakageMonthly = priceGap * currentCustomers;
   const leakageAnnual = leakageMonthly * 12;
   const leakagePercent = (cumulativeInflation / 1) * 100;

   return {
      leakageMonthly,
      leakageAnnual,
      leakagePercent,
      recommendedPrice,
   };
};

/**
 * –°—Ü–µ–Ω–∞—Ä–∏–π –∏–Ω—Ñ–ª—è—Ü–∏–∏: –∫–∞–∫–∞—è –±—É–¥–µ—Ç —Ü–µ–Ω–∞ —á–µ—Ä–µ–∑ N –º–µ—Å—è—Ü–µ–≤
 */
export const projectInflationScenario = (
   currentPrice: number,
   monthsAhead: number,
   annualInflationRate: number = DEFAULT_IT_INFLATION_RATE
): {
   projectedPrice: number;
   totalInflationImpact: number;
   monthlyIncrease: number;
} => {
   const monthlyRate = annualInflationRate / 12;
   const projectedPrice = currentPrice * Math.pow(1 + monthlyRate, monthsAhead);
   const totalInflationImpact = projectedPrice - currentPrice;
   const monthlyIncrease = totalInflationImpact / monthsAhead;

   return {
      projectedPrice,
      totalInflationImpact,
      monthlyIncrease,
   };
};
</file>

<file path="src/core/ltv.ts">
import type { LTVProjection, PricingModel } from './types';

/**
 * –†–∞—Å—á–µ—Ç Customer Lifetime Value (LTV)
 * 
 * –§–æ—Ä–º—É–ª–∞:
 * LTV = ARPU * Gross Margin * Customer Lifetime (–≤ –º–µ—Å—è—Ü–∞—Ö)
 * –≥–¥–µ Customer Lifetime = 1 / Monthly Churn Rate
 */
export const calculateLTV = (
   monthlyRevenue: number,
   monthlyChurnRate: number, // 0.05 = 5% –≤ –º–µ—Å—è—Ü
   grossMarginPercent: number = 80
): LTVProjection => {
   // –†–∞—Å—á–µ—Ç —Å—Ä–µ–¥–Ω–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏ –∫–ª–∏–µ–Ω—Ç–∞ –≤ –º–µ—Å—è—Ü–∞—Ö
   const customerLifetime = 1 / monthlyChurnRate;

   // –í–∞–ª–æ–≤–∞—è –ø—Ä–∏–±—ã–ª—å
   const grossMargin = (monthlyRevenue * grossMarginPercent) / 100;

   // LTV = –°—Ä–µ–¥–Ω–µ–º–µ—Å—è—á–Ω–∞—è –ø—Ä–∏–±—ã–ª—å * –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫–ª–∏–µ–Ω—Ç–∞
   const totalLTV = grossMargin * customerLifetime;

   return {
      model: 'flat_fee',
      monthlyRevenue,
      customerLifetime,
      totalLTV,
      marginAfterCAC: 0,
      paybackPeriod: 0,
   };
};

/**
 * –°—Ä–∞–≤–Ω–µ–Ω–∏–µ LTV –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –ø—Ä–∞–π—Å–∏–Ω–≥–∞
 */
export const compareLTVModels = (
   flatFeePrice: number,
   perSeatPrice: number,
   averageSeatsPerCustomer: number,
   usageBasedPrice: number,
   averageUsagePerCustomer: number,
   monthlyChurnRate: number,
   customerAcquisitionCost: number,
   grossMarginPercent: number = 80
): {
   flatFee: LTVProjection & { paybackMonths: number };
   perSeat: LTVProjection & { paybackMonths: number };
   usageBased: LTVProjection & { paybackMonths: number };
} => {
   // Flat Fee –º–æ–¥–µ–ª—å
   const flatFeeRevenue = flatFeePrice;
   const flatFeeLTV = calculateLTV(flatFeeRevenue, monthlyChurnRate, grossMarginPercent);
   const flatFeePayback = customerAcquisitionCost / (flatFeeRevenue * (grossMarginPercent / 100));

   // Per Seat –º–æ–¥–µ–ª—å
   const perSeatRevenue = perSeatPrice * averageSeatsPerCustomer;
   const perSeatLTV = calculateLTV(perSeatRevenue, monthlyChurnRate, grossMarginPercent);
   const perSeatPayback = customerAcquisitionCost / (perSeatRevenue * (grossMarginPercent / 100));

   // Usage-Based –º–æ–¥–µ–ª—å
   const usageRevenue = usageBasedPrice * averageUsagePerCustomer;
   const usageLTV = calculateLTV(usageRevenue, monthlyChurnRate, grossMarginPercent);
   const usagePayback = customerAcquisitionCost / (usageRevenue * (grossMarginPercent / 100));

   return {
      flatFee: {
         ...flatFeeLTV,
         model: 'flat_fee',
         paybackPeriod: flatFeePayback,
         marginAfterCAC: flatFeeLTV.totalLTV - customerAcquisitionCost,
         paybackMonths: flatFeePayback,
      },
      perSeat: {
         ...perSeatLTV,
         model: 'per_seat',
         paybackPeriod: perSeatPayback,
         marginAfterCAC: perSeatLTV.totalLTV - customerAcquisitionCost,
         paybackMonths: perSeatPayback,
      },
      usageBased: {
         ...usageLTV,
         model: 'usage_based',
         paybackPeriod: usagePayback,
         marginAfterCAC: usageLTV.totalLTV - customerAcquisitionCost,
         paybackMonths: usagePayback,
      },
   };
};

/**
 * –†–∞—Å—á–µ—Ç –≤–ª–∏—è–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω—ã –Ω–∞ LTV
 */
export const calculateLTVImpact = (
   currentPrice: number,
   newPrice: number,
   monthlyChurnRate: number,
   customerAcquisitionCost: number,
   priceElasticity: number = -1.0
): {
   currentLTV: number;
   newLTV: number;
   ltvIncrease: number;
   paybackPeriodChange: number;
} => {
   const currentLTV = calculateLTV(currentPrice, monthlyChurnRate).totalLTV;

   // –ü—Ä–∏ –ø–æ–≤—ã—à–µ–Ω–∏–∏ —Ü–µ–Ω—ã –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è churn
   const priceChangePercent = (newPrice - currentPrice) / currentPrice;
   const churnIncrease = Math.abs(priceChangePercent * priceElasticity * 0.01);
   const newChurnRate = Math.min(monthlyChurnRate + churnIncrease, 0.15); // –º–∞–∫—Å 15% churn

   const newLTV = calculateLTV(newPrice, newChurnRate).totalLTV;

   const currentPayback = customerAcquisitionCost / (currentPrice * 0.8);
   const newPayback = customerAcquisitionCost / (newPrice * 0.8);

   return {
      currentLTV,
      newLTV,
      ltvIncrease: newLTV - currentLTV,
      paybackPeriodChange: newPayback - currentPayback,
   };
};

/**
 * –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è LTV —á–µ—Ä–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –ø—Ä–∞–π—Å–∏–Ω–≥–∞
 */
export const optimizeLTVByModel = (
   currentMonthlyRevenue: number,
   monthlyChurnRate: number,
   customerAcquisitionCost: number,
   models: PricingModel[]
): {
   model: PricingModel;
   ltv: number;
   paybackMonths: number;
   recommendation: string;
}[] => {
   return models
      .map((model) => {
         const ltv = calculateLTV(currentMonthlyRevenue, monthlyChurnRate).totalLTV;
         const payback = customerAcquisitionCost / (currentMonthlyRevenue * 0.8);

         return {
            model,
            ltv,
            paybackMonths: payback,
            recommendation: payback < 12 ? '–û—Ç–ª–∏—á–Ω—ã–π –≤—ã–±–æ—Ä' : '–¢—Ä–µ–±—É–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏',
         };
      })
      .sort((a, b) => b.ltv - a.ltv);
};
</file>

<file path="src/core/pricing.ts">
import type { PricingScenario, RevenueLiftResult, ElasticityModel } from './types';

/**
 * –†–∞—Å—á–µ—Ç –ø—Ä–∏—Ä–æ—Å—Ç–∞ –≤—ã—Ä—É—á–∫–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ü–µ–Ω—ã
 */
export const calculateRevenueLift = (
   scenario: PricingScenario,
   elasticityModel: ElasticityModel // –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∏–∂–µ
): RevenueLiftResult => {
   const {
      currentPrice,
      newPrice,
      currentCustomers,
      averageChurn,
   } = scenario;

   const priceChangePercent = (newPrice - currentPrice) / currentPrice;

   // –ò–°–ü–†–ê–í–õ–ï–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º elasticityModel –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ (—É–±–∏—Ä–∞–µ—Ç ts6133)
   const customerLossPercent = Math.abs(priceChangePercent * elasticityModel.priceElasticity);

   // –£—á–∏—Ç—ã–≤–∞–µ–º –±–∞–∑–æ–≤—ã–π –æ—Ç—Ç–æ–∫ –∏ –ø–æ—Ç–µ—Ä—é –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω—ã
   const totalChurn = (averageChurn / 100 / 12) + customerLossPercent;
   const newCustomerCount = Math.max(currentCustomers * (1 - totalChurn), currentCustomers * 0.5);

   const currentAnnualRevenue = currentPrice * currentCustomers * 12;
   const newAnnualRevenue = newPrice * newCustomerCount * 12;
   const revenueLift = newAnnualRevenue - currentAnnualRevenue;

   return {
      currentAnnualRevenue,
      newAnnualRevenue,
      revenueLift,
      revenueLiftPercent: (revenueLift / currentAnnualRevenue) * 100,
      customerChurnImpact: currentCustomers - newCustomerCount,
      netGain: revenueLift > 0 ? revenueLift : 0,
      breakEvenCustomers: currentAnnualRevenue / (newPrice * 12),
   };
};

/**
 * –†–∞—Å—á–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π —Ü–µ–Ω—ã
 */
export const findOptimalPrice = (
   basePrice: number,
   currentCustomers: number,
   priceElasticity: number, // –¢–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –Ω–∏–∂–µ (—É–±–∏—Ä–∞–µ—Ç ts6133)
   priceRange: { min: number; max: number } = { min: basePrice * 0.5, max: basePrice * 2 }
): { optimalPrice: number; maxRevenue: number } => {
   let maxRevenue = 0;
   let optimalPrice = basePrice;

   const step = (priceRange.max - priceRange.min) / 100;

   for (let price = priceRange.min; price <= priceRange.max; price += step) {
      const priceChangePercent = (price - basePrice) / basePrice;
      // –ò–°–ü–†–ê–í–õ–ï–ù–û: –ò—Å–ø–æ–ª—å–∑—É–µ–º priceElasticity –≤ —Ä–∞—Å—á–µ—Ç–µ
      const demandDrop = Math.abs(priceChangePercent * priceElasticity);
      const revenue = price * (currentCustomers * (1 - demandDrop)) * 12;

      if (revenue > maxRevenue) {
         maxRevenue = revenue;
         optimalPrice = price;
      }
   }

   return { optimalPrice, maxRevenue };
};

/**
 * –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
 */
export const compareScenarios = (
   scenarios: PricingScenario[],
   elasticityModel: ElasticityModel
): RevenueLiftResult[] => {
   // –ò–°–ü–†–ê–í–õ–ï–ù–û: –¢–µ–ø–µ—Ä—å elasticityModel –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (—É–±–∏—Ä–∞–µ—Ç –∫—Ä–∞—Å–Ω—É—é –æ—à–∏–±–∫—É ts2304)
   return scenarios.map((scenario) => calculateRevenueLift(scenario, elasticityModel));
};
</file>

<file path="src/core/types.ts">
export interface PricingInput {
   currentPrice: number;
   currentCustomers: number;
   averageChurn: number; // % –≤ –≥–æ–¥
   customerAcquisitionCost: number;
   averageContractLength: number; // –º–µ—Å—è—Ü—ã
}

export interface PricingScenario extends PricingInput {
   newPrice: number;
   priceElasticity: number; // -0.5 –¥–æ -2.0
}

export interface RevenueLiftResult {
   currentAnnualRevenue: number;
   newAnnualRevenue: number;
   revenueLift: number;
   revenueLiftPercent: number;
   customerChurnImpact: number;
   netGain: number;
   breakEvenCustomers: number;
}

export interface InflationImpact {
   lastPriceIncreaseDate: Date;
   monthsSincePriceIncrease: number;
   itInflationRate: number; // % –≤ –≥–æ–¥
   cumulativeInflationImpact: number;
   recommendedNewPrice: number;
   potentialRecovery: number;
}

export interface LTVProjection {
   model: 'flat_fee' | 'per_seat' | 'usage_based';
   monthlyRevenue: number;
   customerLifetime: number; // –º–µ—Å—è—Ü—ã
   totalLTV: number;
   marginAfterCAC: number;
   paybackPeriod: number; // –º–µ—Å—è—Ü—ã
}

export interface PricingModel {
   name: string;
   type: 'flat_fee' | 'per_seat' | 'usage_based' | 'tiered';
   basePrice: number;
   seats?: number;
   usageUnit?: string;
   usagePrice?: number;
   features: string[];
}

export interface ElasticityModel {
   industry: 'saas' | 'agency' | 'infrastructure';
   priceElasticity: number;
   demandCurve: (price: number) => number; // —Ñ—É–Ω–∫—Ü–∏—è —Å–ø—Ä–æ—Å–∞
}
</file>

<file path="src/csv/types.ts">
export interface CSVRow {
   customerId: string;
   customerName: string;
   currentPrice: number;
   monthlyChurn: number;
   contractStartDate: string;
   seats?: number;
   usage?: number;
   [key: string]: string | number | undefined;
}

export interface ParsedCSVData {
   rows: CSVRow[];
   totalRows: number;
   validRows: number;
   errors: CSVParseError[];
}

export interface CSVParseError {
   rowIndex: number;
   field: string;
   value: any;
   error: string;
}

export interface AnomalyRecord {
   rowIndex: number;
   customerId: string;
   customerName: string;
   currentPrice: number;
   medianPrice: number;
   priceDeviation: number;
   deviationPercent: number;
   severity: 'low' | 'medium' | 'high';
   potentialRecovery: number;
}

export interface CSVAnalysisResult {
   totalCustomers: number;
   totalMRR: number;
   totalARR: number;
   medianPrice: number;
   averagePrice: number;
   anomalies: AnomalyRecord[];
   anomalyCount: number;
   potentialRecoveryTotal: number;
}
</file>

<file path="src/hooks/usePricingCalculations.ts">
import { useState, useCallback } from 'react';
import { calculateRevenueLift, findOptimalPrice } from '../core/pricing';
import { selectElasticityModel } from '../core/elasticity';
import type { PricingScenario, RevenueLiftResult } from '../core/types';

export const usePricingCalculations = () => {
   const [results, setResults] = useState<RevenueLiftResult | null>(null);
   const [isCalculating, setIsCalculating] = useState(false);

   const calculateRevenueLiftScenario = useCallback(
      (scenario: PricingScenario, industry: 'saas' | 'agency' | 'infrastructure') => {
         setIsCalculating(true);
         try {
            const elasticityModel = selectElasticityModel(industry, 'medium');
            const result = calculateRevenueLift(scenario, elasticityModel);
            setResults(result);
            return result;
         } finally {
            setIsCalculating(false);
         }
      },
      []
   );

   const findOptimal = useCallback(
      (
         basePrice: number,
         customers: number,
         elasticity: number,
         range?: { min: number; max: number }
      ) => {
         setIsCalculating(true);
         try {
            const result = findOptimalPrice(basePrice, customers, elasticity, range);
            return result;
         } finally {
            setIsCalculating(false);
         }
      },
      []
   );

   return {
      results,
      isCalculating,
      calculateRevenueLiftScenario,
      findOptimal,
   };
};
</file>

<file path="src/main.tsx">
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.tsx'

createRoot(document.getElementById('root')!).render(
  <StrictMode>
    <App />
  </StrictMode>,
)
</file>

<file path="src/store/appStore.ts">
import { create } from 'zustand';
import type { AppState } from './types';

export const useAppStore = create<AppState>((set) => ({
   quickInputData: null,
   csvData: null,
   csvAnalysis: null,
   revenueLiftResults: null,
   inflationImpact: null,
   ltvProjection: null,
   currentTab: 'quick-input',
   isLoading: false,
   error: null,

   setQuickInputData: (data) => set({ quickInputData: data }),
   setCSVData: (data) => set({ csvData: data }),
   setCSVAnalysis: (analysis) => set({ csvAnalysis: analysis }),
   setRevenueLiftResults: (results) => set({ revenueLiftResults: results }),
   setInflationImpact: (impact) => set({ inflationImpact: impact }),
   setLTVProjection: (projection) => set({ ltvProjection: projection }),
   setCurrentTab: (tab) => set({ currentTab: tab }),
   setLoading: (loading) => set({ isLoading: loading }),
   setError: (error) => set({ error }),

   reset: () =>
      set({
         quickInputData: null,
         csvData: null,
         csvAnalysis: null,
         revenueLiftResults: null,
         inflationImpact: null,
         ltvProjection: null,
         error: null,
      }),
}));
</file>

<file path="src/store/types.ts">
import type { CSVRow, CSVAnalysisResult } from '../csv/types';
import type { RevenueLiftResult, InflationImpact, LTVProjection } from '../core/types';

export interface AppState {
   // Input –¥–∞–Ω–Ω—ã–µ
   quickInputData: {
      currentPrice: number;
      currentCustomers: number;
      customerAcquisitionCost: number;
      averageContractLength: number;
      monthlyChurn: number;
   } | null;

   csvData: CSVRow[] | null;
   csvAnalysis: CSVAnalysisResult | null;

   // –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–æ–≤
   revenueLiftResults: RevenueLiftResult | null;
   inflationImpact: InflationImpact | null;
   ltvProjection: LTVProjection | null;

   // UI —Å–æ—Å—Ç–æ—è–Ω–∏–µ
   currentTab: 'quick-input' | 'csv-upload' | 'templates' | 'inflation';
   isLoading: boolean;
   error: string | null;

   // Actions
   setQuickInputData: (data: AppState['quickInputData']) => void;
   setCSVData: (data: CSVRow[]) => void;
   setCSVAnalysis: (analysis: CSVAnalysisResult) => void;
   setRevenueLiftResults: (results: RevenueLiftResult) => void;
   setInflationImpact: (impact: InflationImpact) => void;
   setLTVProjection: (projection: LTVProjection) => void;
   setCurrentTab: (tab: AppState['currentTab']) => void;
   setLoading: (loading: boolean) => void;
   setError: (error: string | null) => void;
   reset: () => void;
}
</file>

<file path="tsconfig.app.json">
{
  "compilerOptions": {
    "incremental": true,
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.app.tsbuildinfo",
    "target": "ES2022",
    "useDefineForClassFields": true,
    "lib": [
      "ES2022",
      "DOM",
      "DOM.Iterable"
    ],
    "module": "ESNext",
    "types": [
      "vite/client"
    ],
    "skipLibCheck": true,
    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,
    "jsx": "react-jsx",
    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": [
    "src"
  ]
}
</file>

<file path="tsconfig.json">
{
  "files": [],
  "references": [
    { "path": "./tsconfig.app.json" },
    { "path": "./tsconfig.node.json" }
  ]
}
</file>

<file path="tsconfig.node.json">
{
  "compilerOptions": {
    "tsBuildInfoFile": "./node_modules/.tmp/tsconfig.node.tsbuildinfo",
    "target": "ES2023",
    "lib": ["ES2023"],
    "module": "ESNext",
    "types": ["node"],
    "skipLibCheck": true,

    /* Bundler mode */
    "moduleResolution": "bundler",
    "allowImportingTsExtensions": true,
    "verbatimModuleSyntax": true,
    "moduleDetection": "force",
    "noEmit": true,

    /* Linting */
    "strict": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "erasableSyntaxOnly": true,
    "noFallthroughCasesInSwitch": true,
    "noUncheckedSideEffectImports": true
  },
  "include": ["vite.config.ts"]
}
</file>

<file path="vite.config.ts">
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vite.dev/config/
export default defineConfig({
  plugins: [react()],
})
</file>

<file path="package.json">
{
  "name": "pricecheck-mvp",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "tsc -b && vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "date-fns": "^4.1.0",
    "lucide-react": "^0.563.0",
    "papaparse": "^5.5.3",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "react-hook-form": "^7.71.1",
    "recharts": "^3.7.0",
    "zustand": "^5.0.11"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@tailwindcss/postcss": "^4.1.18",
    "@types/node": "^24.10.1",
    "@types/react": "^19.2.7",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "autoprefixer": "^10.4.24",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "postcss": "^8.5.6",
    "tailwindcss": "^4.1.18",
    "typescript": "^5.9.3",
    "typescript-eslint": "^8.48.0",
    "vite": "^7.3.1"
  }
}
</file>

<file path="postcss.config.js">
export default {
   plugins: {
      '@tailwindcss/postcss': {},
      autoprefixer: {},
   },
}
</file>

<file path="src/App.tsx">
// src/App.tsx
import { QuickInputForm } from './components/Forms/QuickInputForm';
import { CSVUploader } from './components/Forms/CSVUploader';
import { RevenueChart } from './components/Results/RevenueChart';
import { AnomalyTable } from './components/Results/AnomalyTable';
import { useAppStore } from './store/appStore';

function App() {
  const { currentTab, setCurrentTab } = useAppStore();

  return (
    <div className="min-h-screen bg-gray-50 text-gray-900 pb-20">
      <header className="bg-white border-b border-gray-200 sticky top-0 z-10 shadow-sm">
        <div className="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
          <div className="flex items-center gap-2">
            <div className="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center text-white font-bold text-xl">‚ÇΩ</div>
            <h1 className="text-2xl font-black tracking-tight text-gray-900">PriceCheck <span className="text-blue-600">MVP</span></h1>
            {/* –î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–π –±–µ–π–¥–∂ PRO */}
            <span className="ml-2 bg-amber-100 text-amber-700 text-[10px] font-black px-2 py-0.5 rounded-md uppercase tracking-tighter">PRO</span>
          </div>
          <nav className="flex bg-gray-100 p-1 rounded-xl border border-gray-200">
            <button
              onClick={() => setCurrentTab('quick-input')}
              className={`px-6 py-2 rounded-lg text-sm font-bold transition-all ${currentTab === 'quick-input' ? 'bg-white text-blue-600 shadow-md' : 'text-gray-500 hover:text-gray-700'}`}
            >
              –°–∏–º—É–ª—è—Ç–æ—Ä
            </button>
            <button
              onClick={() => setCurrentTab('csv-upload')}
              className={`px-6 py-2 rounded-lg text-sm font-bold transition-all ${currentTab === 'csv-upload' ? 'bg-white text-blue-600 shadow-md' : 'text-gray-500 hover:text-gray-700'}`}
            >
              –ü–æ–∏—Å–∫ —É—Ç–µ—á–µ–∫ –≤—ã—Ä—É—á–∫–∏
            </button>
          </nav>
        </div>
      </header>

      <main className="max-w-7xl mx-auto px-4 py-8">
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">

          <section className="space-y-6">
            <div className="bg-white p-8 rounded-3xl shadow-xl border border-gray-100">
              <h2 className="text-xl font-black mb-6 flex items-center gap-3 text-gray-800 uppercase tracking-wider">
                {currentTab === 'quick-input' ? 'üìù –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –±–∏–∑–Ω–µ—Å–∞' : 'üìÅ –ó–∞–≥—Ä—É–∑–∫–∞ –±–∞–∑—ã –∫–ª–∏–µ–Ω—Ç–æ–≤'}
              </h2>
              {currentTab === 'quick-input' ? <QuickInputForm /> : (
                <>
                  <CSVUploader />
                  <AnomalyTable />
                </>
              )}
            </div>
          </section>

          <section className="space-y-6 lg:sticky lg:top-28">
            <RevenueChart />
            <div className="bg-gradient-to-br from-blue-700 via-blue-600 to-indigo-800 p-8 rounded-3xl text-white shadow-2xl relative overflow-hidden">
              <div className="absolute top-0 right-0 p-4 opacity-10 text-6xl">üìà</div>
              <h3 className="text-xl font-black mb-3 flex items-center gap-2">–ê–ª–≥–æ—Ä–∏—Ç–º –∞–Ω–∞–ª–∏–∑–∞</h3>
              <p className="text-blue-50 leading-relaxed font-medium">
                –°–∏—Å—Ç–µ–º–∞ –Ω–∞—Ö–æ–¥–∏—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø–ª–∞—Ç—è—Ç –Ω–∏–∂–µ —Ä—ã–Ω–æ—á–Ω–æ–π (–º–µ–¥–∏–∞–Ω–Ω–æ–π) —Ü–µ–Ω—ã –≤–∞—à–µ–π –∫–æ–º–ø–∞–Ω–∏–∏.
                –ú—ã —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º ¬´—É–ø—É—â–µ–Ω–Ω—É—é –≤—ã–≥–æ–¥—É¬ª –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ–º, —Å–∫–æ–ª—å–∫–æ –≤—ã –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç–µ –ø—Ä–∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ —Ü–µ–Ω –¥–æ –Ω–æ—Ä–º—ã.
              </p>
            </div>
          </section>
        </div>
      </main>
    </div>
  );
}

export default App;
</file>

<file path="src/components/Results/RevenueChart.tsx">
// src/components/Results/RevenueChart.tsx
import React from 'react';
import { BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, Cell } from 'recharts';
import { useAppStore } from '../../store/appStore';

export const RevenueChart: React.FC = () => {
   const { revenueLiftResults } = useAppStore();

   if (!revenueLiftResults) {
      return (
         <div className="h-64 flex items-center justify-center border-2 border-dashed rounded-lg text-gray-400">
            –ù–∞–∂–º–∏—Ç–µ ¬´–†–∞—Å—Å—á–∏—Ç–∞—Ç—å¬ª, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø—Ä–æ–≥–Ω–æ–∑
         </div>
      );
   }

   const data = [
      {
         name: '–¢–µ–∫—É—â–∞—è –≤—ã—Ä—É—á–∫–∞',
         value: revenueLiftResults.currentAnnualRevenue,
         color: '#94a3b8',
      },
      {
         name: '–ü—Ä–æ–≥–Ω–æ–∑ –≤—ã—Ä—É—á–∫–∏',
         value: revenueLiftResults.newAnnualRevenue,
         color: '#2563eb',
      },
   ];

   // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ä—É–±–ª–∏
   const formatCurrency = (value: number) =>
      new Intl.NumberFormat('ru-RU', {
         style: 'currency',
         currency: 'RUB',
         maximumFractionDigits: 0
      }).format(value);

   // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–Ω–∞–∫–∞ (+ –∏–ª–∏ –ø—É—Å—Ç–æ –¥–ª—è –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã—Ö, —Ç–∞–∫ –∫–∞–∫ –º–∏–Ω—É—Å –¥–æ–±–∞–≤–∏—Ç—Å—è —Å–∞–º)
   const getSign = (value: number) => (value > 0 ? '+' : '');

   return (
      <div className="bg-white p-6 rounded-lg shadow-lg">
         <h3 className="text-lg font-bold mb-4 text-gray-800">–ì–æ–¥–æ–≤–æ–π Revenue Lift</h3>
         <div className="h-80 w-full">
            <ResponsiveContainer width="100%" height="100%">
               <BarChart data={data}>
                  <CartesianGrid strokeDasharray="3 3" vertical={false} />
                  <XAxis dataKey="name" />
                  <YAxis tickFormatter={(val) => `${(val / 1000).toFixed(0)}k ‚ÇΩ`} />
                  <Tooltip
                     formatter={(value: number | string | undefined) => {
                        if (value === undefined) return '';
                        return typeof value === 'number' ? formatCurrency(value) : value;
                     }}
                  />
                  <Legend />
                  <Bar dataKey="value" name="–í—ã—Ä—É—á–∫–∞ (‚ÇΩ –≤ –≥–æ–¥)" radius={[4, 4, 0, 0]}>
                     {data.map((entry, index) => (
                        <Cell key={`cell-${index}`} fill={entry.color} />
                     ))}
                  </Bar>
               </BarChart>
            </ResponsiveContainer>
         </div>

         <div className={`mt-4 p-4 rounded-lg border ${revenueLiftResults.revenueLift >= 0 ? 'bg-blue-50 border-blue-100' : 'bg-red-50 border-red-100'}`}>
            <p className={`${revenueLiftResults.revenueLift >= 0 ? 'text-blue-800' : 'text-red-800'} font-medium`}>
               –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π —Ä–æ—Å—Ç:
               <span className="font-bold ml-1">
                  {getSign(revenueLiftResults.revenueLiftPercent)}
                  {revenueLiftResults.revenueLiftPercent.toFixed(1)}%
               </span>
            </p>
            <p className={`${revenueLiftResults.revenueLift >= 0 ? 'text-blue-600' : 'text-red-600'} text-sm`}>
               –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–∏–±—ã–ª—å:
               <span className="ml-1">
                  {getSign(revenueLiftResults.revenueLift)}
                  {formatCurrency(revenueLiftResults.revenueLift)} –≤ –≥–æ–¥
               </span>
            </p>
         </div>
      </div>
   );
};
</file>

<file path="src/csv/anomaly.ts">
import type { CSVRow, CSVAnalysisResult, AnomalyRecord } from './types';

export const analyzeCSVData = (rows: CSVRow[]): CSVAnalysisResult => {
   const prices = rows.map(r => r.currentPrice).sort((a, b) => a - b);

   // –†–∞—Å—á–µ—Ç –º–µ–¥–∏–∞–Ω—ã
   const mid = Math.floor(prices.length / 2);
   const medianPrice = prices.length % 2 !== 0 ? prices[mid] : (prices[mid - 1] + prices[mid]) / 2;

   const anomalies: AnomalyRecord[] = rows
      .filter(r => r.currentPrice < medianPrice)
      .map((r, index) => ({
         rowIndex: index,
         customerId: r.customerId,
         customerName: r.customerName,
         currentPrice: r.currentPrice,
         medianPrice: medianPrice,
         priceDeviation: medianPrice - r.currentPrice,
         deviationPercent: ((medianPrice - r.currentPrice) / medianPrice) * 100,
         severity: (medianPrice - r.currentPrice) / medianPrice > 0.3 ? 'high' : 'medium',
         potentialRecovery: medianPrice - r.currentPrice
      }));

   const totalMRR = rows.reduce((sum, r) => sum + r.currentPrice, 0);

   return {
      totalCustomers: rows.length,
      totalMRR,
      totalARR: totalMRR * 12,
      medianPrice,
      averagePrice: totalMRR / rows.length,
      anomalies,
      anomalyCount: anomalies.length,
      potentialRecoveryTotal: anomalies.reduce((sum, a) => sum + a.potentialRecovery, 0)
   };
};
</file>

<file path="src/csv/parser.ts">
import type { ParsedCSVData, CSVRow } from './types';

export const loadAndParseCSVFile = async (file: File): Promise<ParsedCSVData> => {
   const text = await file.text();
   const cleanText = text.replace(/^\uFEFF/, '').trim();

   if (!cleanText) throw new Error('–§–∞–π–ª –ø—É—Å—Ç');

   const lines = cleanText.split(/\r?\n/).map(l => l.trim()).filter(Boolean);
   const delimiter = lines[0].includes(';') ? ';' : ',';
   const headers = lines[0].split(delimiter).map(h => h.trim().replace(/^["']|["']$/g, ''));

   const rows: CSVRow[] = lines.slice(1).map((line) => {
      const values = line.split(delimiter).map(v => v.trim().replace(/^["']|["']$/g, ''));
      const row: any = {};

      headers.forEach((header, index) => {
         const val = values[index];
         // –ü—Ä–∏–≤–æ–¥–∏–º –∫ —á–∏—Å–ª—É –∫–æ–ª–æ–Ω–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ CSVRow –∑–∞—è–≤–ª–µ–Ω—ã –∫–∞–∫ number
         if (['currentPrice', 'monthlyChurn', 'seats', 'usage'].includes(header)) {
            row[header] = val ? Number(val.replace(',', '.')) : 0;
         } else {
            row[header] = val || '';
         }
      });
      return row as CSVRow;
   });

   return {
      rows,
      totalRows: rows.length,
      validRows: rows.length,
      errors: []
   };
};
</file>

<file path="src/csv/validator.ts">
// src/csv/validator.ts
import type { CSVRow } from './types';

export interface ValidationResult {
   isValid: boolean;
   errors: string[];
   warnings: string[];
}

/**
 * –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö CSV –¥–∞–Ω–Ω—ã—Ö
 */
export const validateCSVData = (rows: CSVRow[]): ValidationResult => {
   const errors: string[] = [];
   const warnings: string[] = [];

   if (!rows || rows.length === 0) {
      errors.push('CSV —Ñ–∞–π–ª –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã—Ö');
      return { isValid: false, errors, warnings };
   }

   if (rows.length < 5) {
      warnings.push('–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–∏–Ω–∏–º—É–º 5 –∑–∞–ø–∏—Å–µ–π –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞');
   }

   rows.forEach((row, index) => {
      // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ customerId (–≤ —Ñ–∞–π–ª–µ C001, C002...)
      if (!row.customerId || String(row.customerId).trim() === '') {
         errors.push(`–°—Ç—Ä–æ–∫–∞ ${index + 2}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç customerId`);
      }

      // 2. –ü—Ä–µ–≤—Ä–∞—â–∞–µ–º —Å—Ç—Ä–æ–∫—É –≤ —á–∏—Å–ª–æ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ü–µ–Ω—ã
      const price = Number(row.currentPrice);

      if (isNaN(price) || price <= 0) {
         errors.push(`–°—Ç—Ä–æ–∫–∞ ${index + 2}: –Ω–µ–≤–∞–ª–∏–¥–Ω–∞—è —Ü–µ–Ω–∞ "${row.currentPrice}" (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —á–∏—Å–ª–æ–º –±–æ–ª—å—à–µ 0)`);
      } else {
         if (price > 1000000) {
            warnings.push(`–°—Ç—Ä–æ–∫–∞ ${index + 2}: –Ω–µ–æ–±—ã—á–Ω–æ –≤—ã—Å–æ–∫–∞—è —Ü–µ–Ω–∞ (${price})`);
         }
      }
   });

   // 3. –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Ä–∞–∑–±—Ä–æ—Å–∞ —Ü–µ–Ω (—Ç–æ–ª—å–∫–æ –¥–ª—è –≤–∞–ª–∏–¥–Ω—ã—Ö —á–∏—Å–µ–ª)
   const validPrices = rows
      .map((r) => Number(r.currentPrice))
      .filter((p) => !isNaN(p) && p > 0);

   if (validPrices.length > 0) {
      const maxPrice = Math.max(...validPrices);
      const minPrice = Math.min(...validPrices);
      const ratio = maxPrice / minPrice;

      if (ratio > 100) {
         warnings.push(
            `–û—á–µ–Ω—å –±–æ–ª—å—à–æ–π —Ä–∞–∑–±—Ä–æ—Å —Ü–µ–Ω (${minPrice.toFixed(2)} - ${maxPrice.toFixed(2)}). –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞–ª—é—Ç—É –∏ –µ–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è.`
         );
      }
   }

   return {
      isValid: errors.length === 0,
      errors,
      warnings,
   };
};

/**
 * –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ —Ñ–∞–π–ª–∞
 */
export const validateFileFormat = (file: File): ValidationResult => {
   const errors: string[] = [];
   const warnings: string[] = [];

   const validExtensions = ['.csv']; // –î–ª—è MVP –æ—Å—Ç–∞–≤–∏–º —Ç–æ–ª—å–∫–æ CSV
   const fileName = file.name.toLowerCase();
   const hasValidExtension = validExtensions.some((ext) => fileName.endsWith(ext));

   if (!hasValidExtension) {
      errors.push('–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ CSV.');
   }

   const maxSize = 10 * 1024 * 1024; // 10MB
   if (file.size > maxSize) {
      errors.push('–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç 10MB');
   }

   if (file.size === 0) {
      errors.push('–í—ã–±—Ä–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –ø—É—Å—Ç');
   }

   return {
      isValid: errors.length === 0,
      errors,
      warnings,
   };
};
</file>

<file path="src/components/Forms/QuickInputForm.tsx">
// src/components/Forms/QuickInputForm.tsx

import React, { useState } from 'react';
import { useForm } from 'react-hook-form';
import { usePricingCalculations } from '../../hooks/usePricingCalculations';
import { useAppStore } from '../../store/appStore';
import { Loader } from '../Common/Loader';

interface QuickInputFormData {
   currentPrice: number;
   currentCustomers: number;
   customerAcquisitionCost: number;
   averageContractLength: number;
   monthlyChurn: number;
   newPrice: number;
   industry: 'saas' | 'agency' | 'infrastructure';
}

export const QuickInputForm: React.FC = () => {
   const { register, handleSubmit, watch } = useForm<QuickInputFormData>({
      defaultValues: {
         currentPrice: 5000,
         currentCustomers: 100,
         customerAcquisitionCost: 2000,
         averageContractLength: 12,
         monthlyChurn: 5,
         newPrice: 6500,
         industry: 'saas',
      },
   });

   const { calculateRevenueLiftScenario } = usePricingCalculations();
   const { setRevenueLiftResults, setQuickInputData } = useAppStore();
   const [isSubmitting, setIsSubmitting] = useState(false);

   // –°–ª–µ–¥–∏–º –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è % —Ä–æ—Å—Ç–∞ —Ü–µ–Ω—ã
   const currentPriceInput = watch('currentPrice');
   const newPriceInput = watch('newPrice');
   const priceChange = currentPriceInput > 0
      ? ((newPriceInput - currentPriceInput) / currentPriceInput) * 100
      : 0;

   const onSubmit = async (data: QuickInputFormData) => {
      setIsSubmitting(true);

      // –ò–º–∏—Ç–∏—Ä—É–µ–º –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –ª–æ–∞–¥–µ—Ä–∞ (–ø–æ–ª–µ–∑–Ω–æ –¥–ª—è UX)
      await new Promise(resolve => setTimeout(resolve, 800));

      try {
         const result = calculateRevenueLiftScenario(
            {
               currentPrice: Number(data.currentPrice),
               newPrice: Number(data.newPrice),
               currentCustomers: Number(data.currentCustomers),
               customerAcquisitionCost: Number(data.customerAcquisitionCost),
               averageContractLength: Number(data.averageContractLength),
               priceElasticity: -1.2,
               averageChurn: Number(data.monthlyChurn),
            },
            data.industry
         );

         if (result) {
            setRevenueLiftResults(result);
            setQuickInputData({
               currentPrice: Number(data.currentPrice),
               currentCustomers: Number(data.currentCustomers),
               customerAcquisitionCost: Number(data.customerAcquisitionCost),
               averageContractLength: Number(data.averageContractLength),
               monthlyChurn: Number(data.monthlyChurn),
            });
         }
      } finally {
         setIsSubmitting(false);
      }
   };

   return (
      <form onSubmit={handleSubmit(onSubmit)} className="space-y-6 bg-white p-6 rounded-lg shadow-lg">
         <h2 className="text-xl font-bold text-gray-800 mb-4">–°–∏–º—É–ª—è—Ç–æ—Ä –≤—ã—Ä—É—á–∫–∏</h2>

         <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            {/* –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ */}
            <div>
               <label className="block text-sm font-medium text-gray-700 mb-2">
                  –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ (‚ÇΩ/–º–µ—Å)
               </label>
               <input
                  type="number"
                  {...register('currentPrice', { required: true, min: 0 })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
               />
            </div>

            {/* –ù–æ–≤–∞—è —Ü–µ–Ω–∞ */}
            <div>
               <label className="block text-sm font-medium text-gray-700 mb-2">
                  –ù–æ–≤–∞—è —Ü–µ–Ω–∞ (‚ÇΩ/–º–µ—Å)
               </label>
               <input
                  type="number"
                  {...register('newPrice', { required: true, min: 0 })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
               />
               <p className={`text-sm mt-1 font-semibold ${priceChange >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                  {priceChange > 0 ? '+' : ''}{priceChange.toFixed(1)}% –∫ —Ü–µ–Ω–µ
               </p>
            </div>

            {/* –ö–ª–∏–µ–Ω—Ç—ã */}
            <div>
               <label className="block text-sm font-medium text-gray-700 mb-2">
                  –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç–æ–≤
               </label>
               <input
                  type="number"
                  {...register('currentCustomers', { required: true, min: 1 })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
               />
            </div>

            {/* Churn */}
            <div>
               <label className="block text-sm font-medium text-gray-700 mb-2">
                  –ú–µ—Å—è—á–Ω—ã–π Churn (%)
               </label>
               <input
                  type="number"
                  step="0.1"
                  {...register('monthlyChurn', { required: true, min: 0, max: 100 })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
               />
            </div>

            {/* –û—Ç—Ä–∞—Å–ª—å */}
            <div className="md:col-span-2">
               <label className="block text-sm font-medium text-gray-700 mb-2">
                  –û—Ç—Ä–∞—Å–ª—å (–≤–ª–∏—è–µ—Ç –Ω–∞ —ç–ª–∞—Å—Ç–∏—á–Ω–æ—Å—Ç—å)
               </label>
               <select
                  {...register('industry')}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none bg-white"
               >
                  <option value="saas">SaaS (–≤—ã—Å–æ–∫–∞—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)</option>
                  <option value="agency">Agency (—Å—Ä–µ–¥–Ω—è—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)</option>
                  <option value="infrastructure">Infrastructure (–Ω–∏–∑–∫–∞—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å)</option>
               </select>
            </div>
         </div>

         <button
            type="submit"
            disabled={isSubmitting}
            className="w-full bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition-all shadow-md disabled:bg-blue-300 active:scale-[0.98] flex items-center justify-center min-h-[52px]"
         >
            {isSubmitting ? (
               <div className="flex items-center gap-3">
                  <Loader size="sm" />
                  <span>–í—ã–ø–æ–ª–Ω—è–µ–º —Ä–∞—Å—á–µ—Ç...</span>
               </div>
            ) : (
               '–†–∞—Å—Å—á–∏—Ç–∞—Ç—å Revenue Lift'
            )}
         </button>
      </form>
   );
};
</file>

<file path="src/hooks/useCSVParser.ts">
// src/hooks/useCSVParser.ts
import { useState, useCallback } from 'react';
import { loadAndParseCSVFile } from '../csv/parser';
import { analyzeCSVData } from '../csv/anomaly';
import { validateCSVData } from '../csv/validator';
// –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ: —Ç–µ–ø–µ—Ä—å —Ç–∏–ø—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —è–≤–Ω–æ
import type { CSVAnalysisResult, CSVRow } from '../csv/types';

export const useCSVParser = () => {
   const [isLoading, setIsLoading] = useState(false);
   const [error, setError] = useState<string | null>(null);

   const parseFile = useCallback(async (file: File): Promise<{ rows: CSVRow[], analysis: CSVAnalysisResult, errors: string[] } | null> => {
      setIsLoading(true);
      setError(null);

      try {
         const parsed = await loadAndParseCSVFile(file);

         const validation = validateCSVData(parsed.rows);
         if (!validation.isValid) {
            const errorMsg = validation.errors.join('; ');
            setError(errorMsg);
            return null;
         }

         const csvAnalysis = analyzeCSVData(parsed.rows);

         // –¢–µ–ø–µ—Ä—å TS –≤–∏–¥–∏—Ç, —á—Ç–æ –º—ã –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—ä–µ–∫—Ç—ã –Ω—É–∂–Ω—ã—Ö —Ç–∏–ø–æ–≤
         return {
            rows: parsed.rows,
            analysis: csvAnalysis,
            errors: []
         };

      } catch (err) {
         const message = err instanceof Error ? err.message : '–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ñ–∞–π–ª–∞';
         setError(message);
         return null;
      } finally {
         setIsLoading(false);
      }
   }, []);

   return {
      isLoading,
      error,
      parseFile,
   };
};
</file>

<file path="src/index.css">
@import "tailwindcss";

@theme {
  --font-sans: "Inter", ui-sans-serif, system-ui, sans-serif;
}
</file>

</files>
