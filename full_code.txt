
--- src/App.css ---
#root {
  max-width: 1280px;
  margin: 0 auto;
  padding: 2rem;
  text-align: center;
}

.logo {
  height: 6em;
  padding: 1.5em;
  will-change: filter;
  transition: filter 300ms;
}
.logo:hover {
  filter: drop-shadow(0 0 2em #646cffaa);
}
.logo.react:hover {
  filter: drop-shadow(0 0 2em #61dafbaa);
}

@keyframes logo-spin {
  from {
    transform: rotate(0deg);
  }
  to {
    transform: rotate(360deg);
  }
}

@media (prefers-reduced-motion: no-preference) {
  a:nth-of-type(2) .logo {
    animation: logo-spin infinite 20s linear;
  }
}

.card {
  padding: 2em;
}

.read-the-docs {
  color: #888;
}

--- src/App.tsx ---
// src/App.tsx
import { useState, useMemo } from 'react';
import { QuickInputForm } from './components/Forms/QuickInputForm';
import { CSVUploader } from './components/Forms/CSVUploader';
import { RevenueChart } from './components/Results/RevenueChart';
import { AnomalyTable } from './components/Results/AnomalyTable';
import { ValuePropTester } from './components/Forms/ValuePropTester';
import { PlaybookSelector } from './components/Playbooks/PlaybookSelector';
import { ExportSection } from './components/Results/ExportSection';
import { useAppStore } from './store/appStore';
import { DiagnosticQuiz } from './components/Quiz/DiagnosticQuiz';
import { suggestPriceAdjustment } from './core/inflation';
import type { ReportData } from './core/types'; // –î–æ–±–∞–≤–ª–µ–Ω–æ —Å–ª–æ–≤–æ type

function App() {
  const {
    currentTab,
    setCurrentTab,
    quickInputData,
    selectedPlaybook,
    inflationSector,
    inflationRegion
  } = useAppStore();

  // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é false, —á—Ç–æ–±—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å–Ω–∞—á–∞–ª–∞ —É–≤–∏–¥–µ–ª –∫–≤–∏–∑
  const [isDiagnosed, setIsDiagnosed] = useState(false);

  // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è PDF-–æ—Ç—á–µ—Ç–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å—Ç–æ—Ä–∞
  const reportData = useMemo((): ReportData | null => {
    if (!quickInputData) return null;

    const adjustment = suggestPriceAdjustment(
      quickInputData.currentPrice,
      quickInputData.lastUpdateDate,
      inflationSector,
      inflationRegion
    );

    return {
      brandName: "My Business", // –ó–¥–µ—Å—å –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ –≤ —Å—Ç–æ—Ä –¥–ª—è –Ω–∞–∑–≤–∞–Ω–∏—è
      currentPricing: {
        price: quickInputData.currentPrice,
        currency: quickInputData.currency || '$',
        lastUpdate: quickInputData.lastUpdateDate,
      },
      recommendedPricing: {
        price: adjustment.suggestedPrice,
        adjustmentReason: adjustment.reasoning,
        inflationImpact: adjustment.adjustmentPercentage,
      },
      selectedPlaybook: selectedPlaybook || undefined,
      comparisonChart: { competitors: [] }, // –î–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –≤ v2
      generatedDate: new Date(),
    };
  }, [quickInputData, selectedPlaybook, inflationSector, inflationRegion]);

  return (
    <div className="min-h-screen bg-gray-50 text-gray-900 pb-20 font-sans">
      <header className="bg-white border-b border-gray-200 sticky top-0 z-50 shadow-sm">
        <div className="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
          <div className="flex items-center gap-2">
            <div className="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center text-white font-bold text-xl">‚ÇΩ</div>
            <h1 className="text-2xl font-black tracking-tight text-gray-900">PriceCheck <span className="text-blue-600">MVP</span></h1>
            <span className="ml-2 bg-amber-100 text-amber-700 text-[10px] font-black px-2 py-0.5 rounded-md uppercase tracking-tighter shadow-sm border border-amber-200">PRO</span>
          </div>

          {isDiagnosed && (
            <nav className="hidden md:flex bg-gray-100 p-1 rounded-xl border border-gray-200 gap-1">
              {[
                { id: 'quick-input', label: '–°–∏–º—É–ª—è—Ç–æ—Ä' },
                { id: 'csv-upload', label: '–£—Ç–µ—á–∫–∏' },
                { id: 'playbooks', label: '–°—Ç—Ä–∞—Ç–µ–≥–∏–∏' },
                { id: 'value-prop', label: '–û—Ñ—Ñ–µ—Ä' }
              ].map((tab) => (
                <button
                  key={tab.id}
                  onClick={() => setCurrentTab(tab.id)}
                  className={`px-4 py-2 rounded-lg text-sm font-bold transition-all ${currentTab === tab.id ? 'bg-white text-blue-600 shadow-md' : 'text-gray-500 hover:text-gray-700'
                    }`}
                >
                  {tab.label}
                </button>
              ))}
            </nav>
          )}
        </div>
      </header>

      <main className="max-w-7xl mx-auto px-4 py-12">
        {!isDiagnosed ? (
          <DiagnosticQuiz onComplete={() => setIsDiagnosed(true)} />
        ) : (
          <div className="space-y-12 animate-in fade-in duration-700">

            {/* –û—Å–Ω–æ–≤–Ω–∞—è —Ä–∞–±–æ—á–∞—è –æ–±–ª–∞—Å—Ç—å */}
            <div className="grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
              <section className="space-y-6">
                <div className="bg-white p-8 rounded-3xl shadow-xl border border-gray-100">
                  <h2 className="text-xl font-black mb-6 flex items-center gap-3 text-gray-800 uppercase tracking-wider">
                    {currentTab === 'quick-input' && 'üìù –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –±–∏–∑–Ω–µ—Å–∞'}
                    {currentTab === 'csv-upload' && 'üìÅ –ó–∞–≥—Ä—É–∑–∫–∞ –±–∞–∑—ã –∫–ª–∏–µ–Ω—Ç–æ–≤'}
                    {currentTab === 'playbooks' && 'üìö –í—ã–±–æ—Ä –ø–ª–µ–π–±—É–∫–∞'}
                    {currentTab === 'value-prop' && 'üéØ –¢–µ—Å—Ç –æ—Ñ—Ñ–µ—Ä–∞'}
                  </h2>

                  {currentTab === 'quick-input' && <QuickInputForm />}
                  {currentTab === 'csv-upload' && (
                    <>
                      <CSVUploader />
                      <AnomalyTable />
                    </>
                  )}
                  {currentTab === 'playbooks' && <PlaybookSelector />}
                  {currentTab === 'value-prop' && <ValuePropTester />}
                </div>
              </section>

              <section className="space-y-6 lg:sticky lg:top-28">
                <RevenueChart />

                {/* –í–∏–¥–∂–µ—Ç –∏–Ω—Ñ–ª—è—Ü–∏–∏ (–ø–æ—è–≤–ª—è–µ—Ç—Å—è –µ—Å–ª–∏ –≤–≤–µ–¥–µ–Ω—ã –¥–∞–Ω–Ω—ã–µ) */}
                {quickInputData && (
                  <div className="bg-white p-6 rounded-3xl border-2 border-amber-100 shadow-sm">
                    <h3 className="text-lg font-bold text-gray-900 mb-2 flex items-center gap-2">
                      <span>üõ°Ô∏è</span> Inflation Guard
                    </h3>
                    <p className="text-sm text-gray-600 mb-4">
                      {suggestPriceAdjustment(quickInputData.currentPrice, quickInputData.lastUpdateDate).reasoning}
                    </p>
                  </div>
                )}

                <div className="bg-gradient-to-br from-blue-700 via-blue-600 to-indigo-800 p-8 rounded-3xl text-white shadow-2xl relative overflow-hidden">
                  <div className="absolute top-0 right-0 p-4 opacity-10 text-6xl rotate-12">üìà</div>
                  <h3 className="text-xl font-black mb-3 flex items-center gap-2">
                    –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∞—è —Å–ø—Ä–∞–≤–∫–∞
                  </h3>
                  <p className="text-blue-50 leading-relaxed font-medium">
                    {currentTab === 'playbooks'
                      ? '–ü–ª–µ–π–±—É–∫–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–Ω—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–π McKinsey –∏ Bain –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–æ—Ö–æ–¥–æ–≤ –≤ —Ä–∞–∑–Ω—ã—Ö –±–∏–∑–Ω–µ—Å-–º–æ–¥–µ–ª—è—Ö.'
                      : '–°–∏—Å—Ç–µ–º–∞ –Ω–∞—Ö–æ–¥–∏—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –ø–ª–∞—Ç—è—Ç –Ω–∏–∂–µ —Ä—ã–Ω–æ—á–Ω–æ–π —Ü–µ–Ω—ã. –ú—ã —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ–º —É–ø—É—â–µ–Ω–Ω—É—é –≤—ã–≥–æ–¥—É –ø—Ä–∏ –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ –¥–æ –Ω–æ—Ä–º—ã.'
                    }
                  </p>
                </div>
              </section>
            </div>

            {/* –°–µ–∫—Ü–∏—è —ç–∫—Å–ø–æ—Ä—Ç–∞ (–ø–æ—è–≤–ª—è–µ—Ç—Å—è –∫–æ–≥–¥–∞ –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ –¥–ª—è –æ—Ç—á–µ—Ç–∞) */}
            {reportData && (
              <section className="pt-12 border-t border-gray-200">
                <ExportSection reportData={reportData} isPremium={false} />
              </section>
            )}
          </div>
        )}
      </main>
    </div>
  );
}

export default App;

--- src/assets/react.svg ---
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" aria-hidden="true" role="img" class="iconify iconify--logos" width="35.93" height="32" preserveAspectRatio="xMidYMid meet" viewBox="0 0 256 228"><path fill="#00D8FF" d="M210.483 73.824a171.49 171.49 0 0 0-8.24-2.597c.465-1.9.893-3.777 1.273-5.621c6.238-30.281 2.16-54.676-11.769-62.708c-13.355-7.7-35.196.329-57.254 19.526a171.23 171.23 0 0 0-6.375 5.848a155.866 155.866 0 0 0-4.241-3.917C100.759 3.829 77.587-4.822 63.673 3.233C50.33 10.957 46.379 33.89 51.995 62.588a170.974 170.974 0 0 0 1.892 8.48c-3.28.932-6.445 1.924-9.474 2.98C17.309 83.498 0 98.307 0 113.668c0 15.865 18.582 31.778 46.812 41.427a145.52 145.52 0 0 0 6.921 2.165a167.467 167.467 0 0 0-2.01 9.138c-5.354 28.2-1.173 50.591 12.134 58.266c13.744 7.926 36.812-.22 59.273-19.855a145.567 145.567 0 0 0 5.342-4.923a168.064 168.064 0 0 0 6.92 6.314c21.758 18.722 43.246 26.282 56.54 18.586c13.731-7.949 18.194-32.003 12.4-61.268a145.016 145.016 0 0 0-1.535-6.842c1.62-.48 3.21-.974 4.76-1.488c29.348-9.723 48.443-25.443 48.443-41.52c0-15.417-17.868-30.326-45.517-39.844Zm-6.365 70.984c-1.4.463-2.836.91-4.3 1.345c-3.24-10.257-7.612-21.163-12.963-32.432c5.106-11 9.31-21.767 12.459-31.957c2.619.758 5.16 1.557 7.61 2.4c23.69 8.156 38.14 20.213 38.14 29.504c0 9.896-15.606 22.743-40.946 31.14Zm-10.514 20.834c2.562 12.94 2.927 24.64 1.23 33.787c-1.524 8.219-4.59 13.698-8.382 15.893c-8.067 4.67-25.32-1.4-43.927-17.412a156.726 156.726 0 0 1-6.437-5.87c7.214-7.889 14.423-17.06 21.459-27.246c12.376-1.098 24.068-2.894 34.671-5.345a134.17 134.17 0 0 1 1.386 6.193ZM87.276 214.515c-7.882 2.783-14.16 2.863-17.955.675c-8.075-4.657-11.432-22.636-6.853-46.752a156.923 156.923 0 0 1 1.869-8.499c10.486 2.32 22.093 3.988 34.498 4.994c7.084 9.967 14.501 19.128 21.976 27.15a134.668 134.668 0 0 1-4.877 4.492c-9.933 8.682-19.886 14.842-28.658 17.94ZM50.35 144.747c-12.483-4.267-22.792-9.812-29.858-15.863c-6.35-5.437-9.555-10.836-9.555-15.216c0-9.322 13.897-21.212 37.076-29.293c2.813-.98 5.757-1.905 8.812-2.773c3.204 10.42 7.406 21.315 12.477 32.332c-5.137 11.18-9.399 22.249-12.634 32.792a134.718 134.718 0 0 1-6.318-1.979Zm12.378-84.26c-4.811-24.587-1.616-43.134 6.425-47.789c8.564-4.958 27.502 2.111 47.463 19.835a144.318 144.318 0 0 1 3.841 3.545c-7.438 7.987-14.787 17.08-21.808 26.988c-12.04 1.116-23.565 2.908-34.161 5.309a160.342 160.342 0 0 1-1.76-7.887Zm110.427 27.268a347.8 347.8 0 0 0-7.785-12.803c8.168 1.033 15.994 2.404 23.343 4.08c-2.206 7.072-4.956 14.465-8.193 22.045a381.151 381.151 0 0 0-7.365-13.322Zm-45.032-43.861c5.044 5.465 10.096 11.566 15.065 18.186a322.04 322.04 0 0 0-30.257-.006c4.974-6.559 10.069-12.652 15.192-18.18ZM82.802 87.83a323.167 323.167 0 0 0-7.227 13.238c-3.184-7.553-5.909-14.98-8.134-22.152c7.304-1.634 15.093-2.97 23.209-3.984a321.524 321.524 0 0 0-7.848 12.897Zm8.081 65.352c-8.385-.936-16.291-2.203-23.593-3.793c2.26-7.3 5.045-14.885 8.298-22.6a321.187 321.187 0 0 0 7.257 13.246c2.594 4.48 5.28 8.868 8.038 13.147Zm37.542 31.03c-5.184-5.592-10.354-11.779-15.403-18.433c4.902.192 9.899.29 14.978.29c5.218 0 10.376-.117 15.453-.343c-4.985 6.774-10.018 12.97-15.028 18.486Zm52.198-57.817c3.422 7.8 6.306 15.345 8.596 22.52c-7.422 1.694-15.436 3.058-23.88 4.071a382.417 382.417 0 0 0 7.859-13.026a347.403 347.403 0 0 0 7.425-13.565Zm-16.898 8.101a358.557 358.557 0 0 1-12.281 19.815a329.4 329.4 0 0 1-23.444.823c-7.967 0-15.716-.248-23.178-.732a310.202 310.202 0 0 1-12.513-19.846h.001a307.41 307.41 0 0 1-10.923-20.627a310.278 310.278 0 0 1 10.89-20.637l-.001.001a307.318 307.318 0 0 1 12.413-19.761c7.613-.576 15.42-.876 23.31-.876H128c7.926 0 15.743.303 23.354.883a329.357 329.357 0 0 1 12.335 19.695a358.489 358.489 0 0 1 11.036 20.54a329.472 329.472 0 0 1-11 20.722Zm22.56-122.124c8.572 4.944 11.906 24.881 6.52 51.026c-.344 1.668-.73 3.367-1.15 5.09c-10.622-2.452-22.155-4.275-34.23-5.408c-7.034-10.017-14.323-19.124-21.64-27.008a160.789 160.789 0 0 1 5.888-5.4c18.9-16.447 36.564-22.941 44.612-18.3ZM128 90.808c12.625 0 22.86 10.235 22.86 22.86s-10.235 22.86-22.86 22.86s-22.86-10.235-22.86-22.86s10.235-22.86 22.86-22.86Z"></path></svg>
--- src/components/Common/Loader.tsx ---
// src/components/Common/Loader.tsx
import React from 'react';

interface LoaderProps {
   size?: 'sm' | 'md' | 'lg';
   label?: string;
}

export const Loader: React.FC<LoaderProps> = ({ size = 'md', label }) => {
   // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Ä–∞–∑–º–µ—Ä–æ–≤ –∫—Ä—É—Ç–∏–ª–∫–∏
   const sizeClasses = {
      sm: 'h-4 w-4 border-2',
      md: 'h-8 w-8 border-3',
      lg: 'h-12 w-12 border-4',
   };

   return (
      <div className="flex flex-col items-center justify-center space-y-3">
         <div
            className={`
          ${sizeClasses[size]} 
          animate-spin 
          rounded-full 
          border-blue-100 
          border-t-blue-600
        `}
         />
         {label && <p className="text-sm text-gray-500 font-medium">{label}</p>}
      </div>
   );
};

--- src/components/Forms/CSVUploader.tsx ---
// src/components/Forms/CSVUploader.tsx
import React, { useCallback, useState } from 'react';
import { useCSVParser } from '../../hooks/useCSVParser';
import { useAppStore } from '../../store/appStore';
import { Loader } from '../Common/Loader';

export const CSVUploader: React.FC = () => {
   const { parseFile, isLoading, error } = useCSVParser();
   const { setCSVData, setCSVAnalysis } = useAppStore();
   const [isDragOver, setIsDragOver] = useState(false);

   const handleFile = useCallback(
      async (file: File) => {
         const result = await parseFile(file);
         if (result && result.errors.length === 0) {
            setCSVData(result.rows);
            setCSVAnalysis(result.analysis);
         }
      },
      [parseFile, setCSVData, setCSVAnalysis]
   );

   const onDrop = (e: React.DragEvent) => {
      e.preventDefault();
      setIsDragOver(false);
      const file = e.dataTransfer.files[0];
      if (file) handleFile(file);
   };

   return (
      <div className="space-y-4">
         <div
            onDragOver={(e) => {
               e.preventDefault();
               setIsDragOver(true);
            }}
            onDragLeave={() => setIsDragOver(false)}
            onDrop={onDrop}
            className={relative border-2 border-dashed rounded-2xl p-10 transition-all flex flex-col items-center justify-center text-center
            ${isDragOver ? 'border-blue-500 bg-blue-50' : 'border-gray-300 bg-gray-50'}
            ${isLoading ? 'opacity-50 pointer-events-none' : 'hover:border-blue-400 hover:bg-white'}
        }
      >
         <input
            type="file"
            accept=".csv"
            onChange={(e) => e.target.files?.[0] && handleFile(e.target.files[0])}
            className="absolute inset-0 w-full h-full opacity-0 cursor-pointer"
         />

         {isLoading ? (
            <Loader label="–ò—â–µ–º —Å–∫—Ä—ã—Ç—É—é –ø—Ä–∏–±—ã–ª—å..." size="md" />
         ) : (
            <>
               <div className="mb-4 p-4 bg-blue-100 rounded-full text-blue-600 text-2xl">
                  üìä
               </div>
               <h3 className="text-lg font-bold text-gray-800">
                  –ü–µ—Ä–µ—Ç–∞—â–∏—Ç–µ –≤–∞—à CSV —Ñ–∞–π–ª
               </h3>
               <p className="text-sm text-gray-500 mt-2">
                  –ú—ã –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º —Ü–µ–Ω—ã –∫–∞–∂–¥–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞ –∏ –Ω–∞–π–¥–µ–º –∞–Ω–æ–º–∞–ª–∏–∏
               </p>
            </>
         )}
      </div>

      {
      error && (
         <div className="p-4 bg-red-50 border border-red-200 rounded-xl text-sm text-red-700">
            <strong>–û—à–∏–±–∫–∞:</strong> {error}
         </div>
      )
   }
    </div >
  );
};

--- src/components/Forms/QuickInputForm.tsx ---
// src/components/Forms/QuickInputForm.tsx
import React, { useState } from 'react';
import { useForm } from 'react-hook-form';
import { usePricingCalculations } from '../../hooks/usePricingCalculations';
import { useAppStore } from '../../store/appStore';
import { Loader } from '../Common/Loader';
import type { PricingScenario, PricingData } from '../../core/types';

interface QuickInputFormData {
   currentPrice: number;
   currentCustomers: number;
   customerAcquisitionCost: number;
   averageContractLength: number;
   monthlyChurn: number;
   newPrice: number;
   industry: 'saas' | 'agency' | 'infrastructure';
}

export const QuickInputForm: React.FC = () => {
   const { register, handleSubmit, watch } = useForm<QuickInputFormData>({
      defaultValues: {
         currentPrice: 5000,
         currentCustomers: 100,
         customerAcquisitionCost: 2000,
         averageContractLength: 12,
         monthlyChurn: 5,
         newPrice: 6500,
         industry: 'saas',
      },
   });

   const { calculateRevenueLiftScenario } = usePricingCalculations();
   const { setRevenueLiftResults, setQuickInputData } = useAppStore();
   const [isSubmitting, setIsSubmitting] = useState(false);

   const currentPriceInput = watch('currentPrice');
   const newPriceInput = watch('newPrice');
   const priceChange =
      currentPriceInput > 0
         ? ((newPriceInput - currentPriceInput) / currentPriceInput) * 100
         : 0;

   const onSubmit = async (data: QuickInputFormData) => {
      setIsSubmitting(true);
      await new Promise((resolve) => setTimeout(resolve, 600));

      try {
// –°–æ–∑–¥–∞–µ–º —Å—Ü–µ–Ω–∞—Ä–∏–π –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞
         const scenario: PricingScenario = {
            currentPrice: Number(data.currentPrice),
            newPrice: Number(data.newPrice),
            currentCustomers: Number(data.currentCustomers),
            customerAcquisitionCost: Number(data.customerAcquisitionCost),
            averageContractLength: Number(data.averageContractLength),
            priceElasticity: -1.2,
            averageChurn: Number(data.monthlyChurn),
         };

         const result = calculateRevenueLiftScenario(scenario, data.industry);

         if (result) {
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ä–∞—Å—á–µ—Ç–∞
            setRevenueLiftResults(result);

            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            const pricingData: PricingData = {
               currentPrice: Number(data.currentPrice),
               currentCustomers: Number(data.currentCustomers),
               customerAcquisitionCost: Number(data.customerAcquisitionCost),
               averageContractLength: Number(data.averageContractLength),
               currency: '‚ÇΩ',
               lastUpdateDate: new Date(),
            };

            setQuickInputData(pricingData);
         }
      } finally {
         setIsSubmitting(false);
      }
   };

   return (
      <form
         onSubmit={handleSubmit(onSubmit)}
         className="space-y-6 bg-white p-6 rounded-lg shadow-lg"
      >
         <h2 className="text-xl font-bold text-gray-800 mb-4">
            –°–∏–º—É–ª—è—Ç–æ—Ä –≤—ã—Ä—É—á–∫–∏ –∏ –ø—Ä–∏–±—ã–ª–∏
         </h2>

         <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            {/* –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ */}
            <div>
               <label className="block text-sm font-medium text-gray-700 mb-2">
                  –¢–µ–∫—É—â–∞—è —Ü–µ–Ω–∞ (‚ÇΩ/–º–µ—Å)
               </label>
               <input
                  type="number"
                  {...register('currentPrice', { required: true, min: 0 })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
               />
            </div>

            {/* –ù–æ–≤–∞—è —Ü–µ–Ω–∞ */}
            <div>
               <label className="block text-sm font-medium text-gray-700 mb-2">
                  –ù–æ–≤–∞—è —Ü–µ–Ω–∞ (‚ÇΩ/–º–µ—Å)
               </label>
               <input
                  type="number"
                  {...register('newPrice', { required: true, min: 0 })}
                  className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
               />
               <p
                  className={text - sm mt-1 font-semibold ${
              priceChange >= 0 ? 'text-green-600' : 'text-red-600'
                  }}
          >
               {priceChange > 0 ? '+' : ''}
               {priceChange.toFixed(1)}% –∫ —Ü–µ–Ω–µ
            </p>
         </div>

         {/* –ö–ª–∏–µ–Ω—Ç—ã */}
         <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
               –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∏–µ–Ω—Ç–æ–≤
            </label>
            <input
               type="number"
               {...register('currentCustomers', { required: true, min: 1 })}
               className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
            />
         </div>

         {/* CAC */}
         <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
               CAC (–°—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è, ‚ÇΩ)
            </label>
            <input
               type="number"
               {...register('customerAcquisitionCost', { required: true, min: 0 })}
               className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
            />
         </div>

         {/* Churn */}
         <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
               –ú–µ—Å—è—á–Ω—ã–π Churn (%)
            </label>
            <input
               type="number"
               step="0.1"
               {...register('monthlyChurn', { required: true, min: 0, max: 100 })}
               className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none"
            />
         </div>

         {/* –û—Ç—Ä–∞—Å–ª—å */}
         <div>
            <label className="block text-sm font-medium text-gray-700 mb-2">
               –û—Ç—Ä–∞—Å–ª—å
            </label>
            <select
               {...register('industry')}
            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none bg-white"
          >
            <option value="saas">SaaS</option>
            <option value="agency">Agency</option>
            <option value="infrastructure">Infrastructure</option>
          </select>
        </div>
      </div>

      <button
        type="submit"
        disabled={isSubmitting}
        className="w-full bg-blue-600 text-white py-3 rounded-lg font-bold hover:bg-blue-700 transition-all shadow-md disabled:bg-blue-300 flex items-center justify-center min-h-[52px]"
      >
        {isSubmitting ? (
          <div className="flex items-center gap-3">
            <Loader size="sm" />
            <span>–í—ã–ø–æ–ª–Ω—è–µ–º —Ä–∞—Å—á–µ—Ç...</span>
          </div>
        ) : (
          '–†–∞—Å—Å—á–∏—Ç–∞—Ç—å Revenue & Profit Lift'
        )}
      </button>
    </form >
  );
};

--- src/components/Forms/ValuePropTester.tsx ---
// src/components/Forms/ValuePropTester.tsx
import React, { useState } from 'react';

const HYPOTHESES = [
   {
      segment: 'B2B SaaS –∫–æ–º–ø–∞–Ω–∏–∏ –Ω–∞ —Å—Ç–∞–¥–∏–∏ —Ä–æ—Å—Ç–∞',
      problem: '–¢—Ä–∞—Ç—è—Ç —Å–æ—Ç–Ω–∏ —Ç—ã—Å—è—á –Ω–∞ —Ä–µ–∫–ª–∞–º—É, –Ω–æ –Ω–µ –ø–æ–Ω–∏–º–∞—é—Ç, –∫–∞–∫–æ–π –∫–∞–Ω–∞–ª —Ä–µ–∞–ª—å–Ω–æ –ø—Ä–∏–Ω–æ—Å–∏—Ç –ø—Ä–∏–±—ã–ª—å',
      solution: '–ú–æ–¥—É–ª—å —Å–∫–≤–æ–∑–Ω–æ–π –∞–Ω–∞–ª–∏—Ç–∏–∫–∏ —Å AI-–ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ–º LTV',
      benefit: '–†–æ—Å—Ç –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏ –º–∞—Ä–∫–µ—Ç–∏–Ω–≥–∞ (ROMI) –Ω–∞ 35% –∑–∞ –ø–µ—Ä–≤—ã–π –∫–≤–∞—Ä—Ç–∞–ª'
   },
   {
      segment: 'Digital-–∞–≥–µ–Ω—Ç—Å—Ç–≤–∞ —Å —á–µ–∫–æ–º –æ—Ç 100–∫',
      problem: '–ö–ª–∏–µ–Ω—Ç—ã —É—Ö–æ–¥—è—Ç —á–µ—Ä–µ–∑ 3 –º–µ—Å—è—Ü–∞ –∏–∑-–∑–∞ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ø—Ä–æ–∑—Ä–∞—á–Ω—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤',
      solution: '–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–∞—à–±–æ—Ä–¥ –æ—Ç—á–µ—Ç–Ω–æ—Å—Ç–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏',
      benefit: '–£–≤–µ–ª–∏—á–µ–Ω–∏–µ LTV –∫–ª–∏–µ–Ω—Ç–∞ –Ω–∞ 50% –∏ —Å–Ω–∏–∂–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞ –æ—Ç—á–µ—Ç—ã –≤ 4 —Ä–∞–∑–∞'
   },
   {
      segment: '–í–ª–∞–¥–µ–ª—å—Ü—ã –æ–Ω–ª–∞–π–Ω-—à–∫–æ–ª',
      problem: '–í—ã—Å–æ–∫–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –ª–∏–¥–∞ (CAC) –∏ –Ω–∏–∑–∫–∞—è –¥–æ—Ö–æ–¥–∏–º–æ—Å—Ç—å –¥–æ –∫–æ–Ω—Ü–∞ –∫—É—Ä—Å–∞',
      solution: '–ò–≥—Ä–æ–≤–∞—è –º–µ—Ö–∞–Ω–∏–∫–∞ –æ–±—É—á–µ–Ω–∏—è —Å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–º –ò–ò-–Ω–∞—Å—Ç–∞–≤–Ω–∏–∫–æ–º',
      benefit: '–ü–æ–≤—ã—à–µ–Ω–∏–µ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –≤ –ø–æ–∫—É–ø–∫—É —Å–ª–µ–¥—É—é—â–µ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞ –Ω–∞ 25%'
   }
];

export const ValuePropTester: React.FC = () => {
   const [formData, setFormData] = useState({
      segment: '',
      problem: '',
      solution: '',
      benefit: ''
   });

   const generateRandom = () => {
      const random = HYPOTHESES[Math.floor(Math.random() * HYPOTHESES.length)];
      setFormData(random);
   };

   const calculateScore = () => {
      let score = 0;
      if (formData.segment.trim().length > 10) score += 25;
      if (formData.problem.trim().length > 20) score += 25;
      if (formData.solution.trim().length > 10) score += 25;
      const hasMetrics = /[%‚ÇΩ$]|(–¥–µ–Ω—å|–º–µ—Å|–≥–æ–¥|—á–∞—Å)/i.test(formData.benefit);
      if (hasMetrics && formData.benefit.length > 5) score += 25;
      return score;
   };

   const score = calculateScore();

   return (
      <div className="space-y-8 animate-in fade-in duration-500">
         <div className="bg-indigo-50 border-l-4 border-indigo-500 p-6 rounded-r-2xl flex justify-between items-start">
            <div className="max-w-[70%]">
               <div className="flex items-center gap-3 mb-2">
                  <span className="text-xl">üéØ</span>
                  <h3 className="text-indigo-800 font-black uppercase text-sm tracking-widest">–¢–µ—Å—Ç –æ—Ñ—Ñ–µ—Ä–∞</h3>
               </div>
               <p className="text-indigo-700 text-sm leading-relaxed font-medium">
                  –°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π—Ç–µ —Ü–µ–Ω–Ω–æ—Å—Ç—å –≤–∞—à–µ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞. –°–∏–ª—å–Ω—ã–π –æ—Ñ—Ñ–µ—Ä ‚Äî —ç—Ç–æ 80% —É—Å–ø–µ—Ö–∞ –≤ –ø—Ä–æ–¥–∞–∂–∞—Ö.
               </p>
            </div>
            <button
               onClick={generateRandom}
               className="bg-white text-indigo-600 border border-indigo-200 px-4 py-2 rounded-xl text-xs font-black shadow-sm hover:bg-indigo-100 transition-all active:scale-95"
            >
               üé≤ –ì–ï–ù–ï–†–ò–†–û–í–ê–¢–¨ –ü–†–ò–ú–ï–†
            </button>
         </div>

         <div className="grid gap-5">
            {[
               { id: 'segment', label: '–î–ª—è –∫–æ–≥–æ —ç—Ç–æ? (–°–µ–≥–º–µ–Ω—Ç)', placeholder: '–ù–∞–ø—Ä: –í–ª–∞–¥–µ–ª—å—Ü—ã –æ–Ω–ª–∞–π–Ω-—à–∫–æ–ª...' },
               { id: 'problem', label: '–ö–∞–∫–∞—è –±–æ–ª—å? (–ü—Ä–æ–±–ª–µ–º–∞)', placeholder: '–ù–∞–ø—Ä: –¢—Ä–∞—Ç—è—Ç –±—é–¥–∂–µ—Ç –≤–ø—É—Å—Ç—É—é...', isArea: true },
               { id: 'solution', label: '–ß—Ç–æ –¥–∞–µ—Ç–µ? (–†–µ—à–µ–Ω–∏–µ)', placeholder: '–ù–∞–ø—Ä: –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ-–≤–æ—Ä–æ–Ω–æ–∫...' },
               { id: 'benefit', label: '–ß—Ç–æ –≤ –∏—Ç–æ–≥–µ? (–¢–≤–µ—Ä–¥—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç)', placeholder: '–ù–∞–ø—Ä: –†–æ—Å—Ç –æ–∫—É–ø–∞–µ–º–æ—Å—Ç–∏ –Ω–∞ 40%...' },
            ].map((field) => (
               <div key={field.id} className="space-y-2">
                  <label className="text-[10px] font-black uppercase text-gray-400 tracking-wider ml-1">{field.label}</label>
                  {field.isArea ? (
                     <textarea
                        value={formData[field.id as keyof typeof formData]}
                        placeholder={field.placeholder}
                        className="w-full p-4 bg-white border-2 border-gray-100 rounded-2xl focus:border-indigo-500 outline-none transition-all h-24 shadow-sm"
                        onChange={(e) => setFormData({ ...formData, [field.id]: e.target.value })}
                     />
                  ) : (
                     <input
                        type="text"
                        value={formData[field.id as keyof typeof formData]}
                        placeholder={field.placeholder}
                        className="w-full p-4 bg-white border-2 border-gray-100 rounded-2xl focus:border-indigo-500 outline-none transition-all shadow-sm"
                        onChange={(e) => setFormData({ ...formData, [field.id]: e.target.value })}
                     />
                  )}
               </div>
            ))}
         </div>

         {/* –®–∫–∞–ª–∞ —Å–∏–ª—ã –æ—Ñ—Ñ–µ—Ä–∞ */}
         <div className="pt-8 border-t-2 border-dashed border-gray-100">
            <div className="flex justify-between items-center mb-6">
               <div>
                  <h4 className="font-black text-gray-900 text-2xl uppercase tracking-tighter">–°–∏–ª–∞ –æ—Ñ—Ñ–µ—Ä–∞</h4>
                  <p className="text-xs font-bold text-gray-400 uppercase mt-1">–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è Growth Map</p>
               </div>
               <span className={`text-5xl font-black italic ${score > 75 ? 'text-green-500' : score > 40 ? 'text-amber-500' : 'text-red-400'}`}>
                  {score}%
               </span>
            </div>
            <div className="w-full bg-gray-100 h-5 rounded-full overflow-hidden p-1">
               <div
                  className={`h-full rounded-full transition-all duration-700 ease-out ${score > 75 ? 'bg-green-500' : score > 40 ? 'bg-amber-500' : 'bg-red-400'
                     }`}
                  style={{ width: `${score}%` }}
               ></div>
            </div>
         </div>
      </div>
   );
};

--- src/components/Playbooks/PlaybookSelector.tsx ---
import React from 'react';

// –í–∞–∂–Ω–æ: —ç–∫—Å–ø–æ—Ä—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∏ –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–º, –∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
export const PlaybookSelector: React.FC = () => {
   return (
      <div className="p-6 border-2 border-dashed border-gray-200 rounded-2xl bg-white text-center">
         <p className="text-gray-500 font-medium">–ú–æ–¥—É–ª—å –≤—ã–±–æ—Ä–∞ —Å—Ç—Ä–∞—Ç–µ–≥–∏–π (Playbooks) –∞–∫—Ç–∏–≤–µ–Ω</p>
      </div>
   );
};

export default PlaybookSelector;

--- src/components/Quiz/DiagnosticQuiz.tsx ---
// src/components/Quiz/DiagnosticQuiz.tsx
import React, { useState } from 'react';

// –†–∞—Å—à–∏—Ä—è–µ–º —Ç–∏–ø—ã —à–∞–≥–æ–≤ –¥–ª—è –≤—Å–µ–π –∫–∞—Ä—Ç—ã
type QuizStep =
   | 'intro'
   | 'q_sales_exist'
   | 'q_funnel_bottleneck'
   | 'q_high_check'
   | 'q_market_capacity'
   | 'q_product_ready'
   | 'q_custdev_done'
   | 'q_feedback_type'
   | 'result';

export const DiagnosticQuiz: React.FC<{ onComplete: () => void }> = ({ onComplete }) => {
   const [step, setStep] = useState<QuizStep>('intro');
   const [diagnosis, setDiagnosis] = useState<string>('');
   const [recommendation, setRecommendation] = useState<{ title: string, action: string }>({
      title: '–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∞–Ω–∞–ª–∏–∑–∞',
      action: '–û—Ç–∫—Ä—ã—Ç—å —Å–∏—Å—Ç–µ–º—É'
   });

   const renderIntro = () => (
      <div className="text-center space-y-6 max-w-2xl mx-auto py-10">
         <div className="inline-flex items-center justify-center w-20 h-20 bg-blue-600 text-white rounded-3xl text-4xl shadow-xl mb-4">üìà</div>
         <h2 className="text-4xl font-black text-gray-900 leading-tight">–ù–∞–π–¥–µ–º –≤–∞—à—É —Ç–æ—á–∫—É —Ä–æ—Å—Ç–∞ –∑–∞ 1 –º–∏–Ω—É—Ç—É</h2>
         <p className="text-gray-600 text-xl leading-relaxed">
            –ú—ã –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –≤–∞—à –ø—Ä–æ–µ–∫—Ç –ø–æ –º–µ—Ç–æ–¥–æ–ª–æ–≥–∏–∏ <b>Sales Growth Map</b>.
            –£–∑–Ω–∞–π—Ç–µ, –ø–æ—á–µ–º—É –ø—Ä–æ–¥–∞–∂–∏ –Ω–µ —Ä–∞—Å—Ç—É—Ç x2-x5 –∏ —á—Ç–æ –Ω—É–∂–Ω–æ ¬´–ø–æ–¥–∫—Ä—É—Ç–∏—Ç—å¬ª –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å.
         </p>
         <button
            onClick={() => setStep('q_sales_exist')}
            className="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-5 px-8 rounded-2xl shadow-lg transition-all transform hover:scale-[1.02] text-lg"
         >
            –ù–∞—á–∞—Ç—å –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫—É ‚Üí
         </button>
      </div>
   );

   const renderQuestion = (title: string, options: { label: string, next: QuizStep, diag?: string, rec?: { title: string, action: string } }[]) => (
      <div className="space-y-6 py-6 animate-in fade-in slide-in-from-bottom-4 duration-500">
         <h3 className="text-2xl font-black text-gray-800 text-center mb-8">{title}</h3>
         <div className="grid gap-4 max-w-xl mx-auto">
            {options.map((opt, i) => (
               <button
                  key={i}
                  onClick={() => {
                     if (opt.diag) setDiagnosis(opt.diag);
                     if (opt.rec) setRecommendation(opt.rec);
                     setStep(opt.next);
                  }}
                  className="text-left p-6 border-2 border-gray-100 hover:border-blue-500 hover:bg-blue-50 rounded-2xl transition-all group shadow-sm hover:shadow-md"
               >
                  <span className="text-lg font-bold text-gray-700 group-hover:text-blue-700">{opt.label}</span>
               </button>
            ))}
         </div>
      </div>
   );

   return (
      <div className="bg-white p-8 md:p-12 rounded-[40px] shadow-2xl border border-gray-100 min-h-[550px] flex flex-col justify-center">
         {step === 'intro' && renderIntro()}

         {/* --- –ì–õ–ê–í–ù–ê–Ø –†–ê–ó–í–ò–õ–ö–ê --- */}
         {step === 'q_sales_exist' && renderQuestion('–ü—Ä–æ–¥–∞–∂–∏ –µ—Å—Ç—å?', [
            { label: '–î–∞, –µ—Å—Ç—å —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –ø—Ä–æ–¥–∞–∂–∏', next: 'q_funnel_bottleneck' },
            { label: '–ù–µ—Ç, –ø—Ä–æ–¥–∞–∂ –ø–æ–∫–∞ –Ω–µ—Ç', next: 'q_product_ready' }
         ])}

         {/* --- –í–ï–¢–ö–ê: –ü–†–û–î–ê–ñ –ù–ï–¢ (–£–∂–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ) --- */}
         {step === 'q_product_ready' && renderQuestion('–£ –≤–∞—Å —É–∂–µ –µ—Å—Ç—å –≥–æ—Ç–æ–≤—ã–π –ø—Ä–æ–¥—É–∫—Ç?', [
            { label: '–î–∞, –ø—Ä–æ–¥—É–∫—Ç –≥–æ—Ç–æ–≤ / MVP', next: 'q_custdev_done' },
            { label: '–ù–µ—Ç, –ø–æ–∫–∞ —Ç–æ–ª—å–∫–æ –∏–¥–µ—è', next: 'result', diag: '–õ–æ–≤—É—à–∫–∞ "–ü–∏–ª–∏–ª—å—â–∏–∫–∞". –í—ã –±–æ–∏—Ç–µ—Å—å —Ä—ã–Ω–∫–∞. –°—Ä–æ—á–Ω–æ –∏–¥–∏—Ç–µ –∫ –∫–ª–∏–µ–Ω—Ç–∞–º —Å –æ—Ñ—Ñ–µ—Ä–æ–º –Ω–∞ —Å–∞–ª—Ñ–µ—Ç–∫–µ.', rec: { title: 'CustDev –ú–æ–¥—É–ª—å', action: '–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–∏–ø–æ—Ç–µ–∑—É' } }
         ])}

         {step === 'q_custdev_done' && renderQuestion('–í—ã –ø—Ä–æ–±–æ–≤–∞–ª–∏ –≤—ã—Ö–æ–¥–∏—Ç—å –Ω–∞ –∫–ª–∏–µ–Ω—Ç–æ–≤?', [
            { label: '–î–∞, –æ–±—â–∞–ª–∏—Å—å —Å —Ä—ã–Ω–∫–æ–º', next: 'q_feedback_type' },
            { label: '–ù–µ—Ç, –Ω–µ –ø—Ä–æ–±–æ–≤–∞–ª–∏', next: 'result', diag: '–ü—Ä–æ–±–ª–µ–º–∞ –Ω–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞. –í—ã —Ä–∏—Å–∫—É–µ—Ç–µ —Å–¥–µ–ª–∞—Ç—å –Ω–µ–Ω—É–∂–Ω—ã–π –ø—Ä–æ–¥—É–∫—Ç. –ù—É–∂–µ–Ω –±—ã—Å—Ç—Ä—ã–π CustDev.', rec: { title: '–°–∫—Ä–∏–ø—Ç—ã –∏–Ω—Ç–µ—Ä–≤—å—é', action: '–ò–∑—É—á–∏—Ç—å' } }
         ])}

         {step === 'q_feedback_type' && renderQuestion('–ß—Ç–æ –≥–æ–≤–æ—Ä—è—Ç –∫–ª–∏–µ–Ω—Ç—ã?', [
            { label: '–ü—Ä–æ–¥—É–∫—Ç –Ω–µ —Ä–µ—à–∞–µ—Ç –∏—Ö –±–æ–ª—å', next: 'result', diag: '–û—Ñ—Ñ–µ—Ä "–º–∏–º–æ". –í–∞—à–µ —Ä–µ—à–µ–Ω–∏–µ –Ω–µ –ø–æ–ø–∞–¥–∞–µ—Ç –≤ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å. –ù—É–∂–µ–Ω –ø–∏–≤–æ—Ç –∏–ª–∏ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á.', rec: { title: 'Value Prop Canvas', action: '–ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –æ—Ñ—Ñ–µ—Ä' } },
            { label: '–≠—Ç–æ –Ω–µ –∏—Ö –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç', next: 'result', diag: '–û—à–∏–±–∫–∞ –≤ —Å–µ–≥–º–µ–Ω—Ç–µ. –í—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç–µ —Ä–µ—à–µ–Ω–∏–µ —Ç–µ–º, —É –∫–æ–≥–æ —Å–µ–π—á–∞—Å "–Ω–µ –±–æ–ª–∏—Ç". –°–º–µ–Ω–∏—Ç–µ –¶–ê.', rec: { title: '–°–µ–≥–º–µ–Ω—Ç–∞—Ü–∏—è', action: '–ù–∞–π—Ç–∏ "–≥–æ—Ä—è—á–∏—Ö"' } }
         ])}

         {/* --- –í–ï–¢–ö–ê: –ü–†–û–î–ê–ñ–ò –ï–°–¢–¨ (–ù–û–í–û–ï) --- */}
         {step === 'q_funnel_bottleneck' && renderQuestion('–í –≤–æ—Ä–æ–Ω–∫–µ –µ—Å—Ç—å "–∑–∞—Ç—ã–∫–∏" (–∫–æ–Ω–≤–µ—Ä—Å–∏—è –Ω–∏–∂–µ x2-x3)?', [
            { label: '–î–∞, –ª–∏–¥—ã –ø—Ä–∏—Ö–æ–¥—è—Ç, –Ω–æ –Ω–µ –ø–æ–∫—É–ø–∞—é—Ç', next: 'result', diag: '–ü—Ä–æ–±–ª–µ–º–∞ –≤ –¥–æ–Ω–µ—Å–µ–Ω–∏–∏ —Ü–µ–Ω–Ω–æ—Å—Ç–∏ –∏–ª–∏ –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ü–∏–∏. –õ–∏–¥—ã "—Ö–æ–ª–æ–¥–Ω—ã–µ" –∏–ª–∏ –º–µ–Ω–µ–¥–∂–µ—Ä—ã –Ω–µ —É–º–µ—é—Ç –ø—Ä–æ–¥–∞–≤–∞—Ç—å.', rec: { title: '–ê–Ω–∞–ª–∏–∑ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏', action: '–ù–∞–π—Ç–∏ —É–∑–∫–æ–µ –º–µ—Å—Ç–æ' } },
            { label: '–ù–µ—Ç, –≤ –≤–æ—Ä–æ–Ω–∫–µ –≤—Å—ë —Ä–æ–≤–Ω–æ', next: 'q_high_check' }
         ])}

         {step === 'q_high_check' && renderQuestion('–ü—Ä–æ–±–æ–≤–∞–ª–∏ –ª–∏ –≤—ã —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ –ø–æ–≤—ã—à–∞—Ç—å —á–µ–∫?', [
            { label: '–ù–µ—Ç, –±–æ–∏–º—Å—è –ø–æ—Ç–µ—Ä—è—Ç—å –∫–ª–∏–µ–Ω—Ç–æ–≤', next: 'result', diag: '–¢–æ—á–∫–∞ —Ä–æ—Å—Ç–∞ –≤ —Ü–µ–Ω–µ! –°–∫–æ—Ä–µ–µ –≤—Å–µ–≥–æ, –≤—ã –Ω–µ–¥–æ–∑–∞—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç–µ 20-30% –ø—Ä–∏–±—ã–ª–∏ –∏–∑-–∑–∞ "—Å—Ç—Ä–∞—Ö–∞ —Ü–µ–Ω—ã".', rec: { title: '–ü–æ–∏—Å–∫ —É—Ç–µ—á–µ–∫ –≤—ã—Ä—É—á–∫–∏', action: '–ó–∞–≥—Ä—É–∑–∏—Ç—å CSV' } },
            { label: '–î–∞, –Ω–æ –ø–æ–∫—É–ø–∞—é—Ç —Ö—É–∂–µ', next: 'q_market_capacity' }
         ])}

         {step === 'q_market_capacity' && renderQuestion('–ó–∞–Ω—è—Ç–∞ –ª–∏ –≤—Å—è –µ–º–∫–æ—Å—Ç—å –≤–∞—à–µ–≥–æ —Ç–µ–∫—É—â–µ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞?', [
            { label: '–î–∞, –º—ã –ª–∏–¥–µ—Ä—ã –≤ —ç—Ç–æ–π –Ω–∏—à–µ', next: 'result', diag: '–ü–æ—Ç–æ–ª–æ–∫ –≤ —Ç–µ–∫—É—â–µ–º –ø—Ä–æ–¥—É–∫—Ç–µ. –ù—É–∂–Ω–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å –ø—Ä–æ–¥—É–∫—Ç–æ–≤—É—é –ª–∏–Ω–µ–π–∫—É –∏–ª–∏ –≤—ã—Ö–æ–¥–∏—Ç—å –≤ —Å–º–µ–∂–Ω—ã–µ –Ω–∏—à–∏.', rec: { title: 'Simulator What-If', action: '–ü—Ä–æ—Å—á–∏—Ç–∞—Ç—å –Ω–æ–≤—ã–µ —Ä—ã–Ω–∫–∏' } },
            { label: '–ù–µ—Ç, –∫–ª–∏–µ–Ω—Ç–æ–≤ –µ—â–µ –º–Ω–æ–≥–æ', next: 'result', diag: '–ü—Ä–æ–±–ª–µ–º–∞ –≤ —Ç—Ä–∞—Ñ–∏–∫–µ –∏–ª–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–∏ –ø—Ä–æ–¥–∞–∂. –£ –≤–∞—Å —Ä–∞–±–æ—á–∏–π –ø—Ä–æ–¥—É–∫—Ç, –ø—Ä–æ—Å—Ç–æ –ª–µ–π—Ç–µ –±–æ–ª—å—à–µ –±–µ–Ω–∑–∏–Ω–∞ –≤ –≤–æ—Ä–æ–Ω–∫—É.', rec: { title: 'Scale Calculator', action: '–°—á–∏—Ç–∞—Ç—å –±—é–¥–∂–µ—Ç' } }
         ])}

         {/* --- –ò–¢–û–ì–û–í–´–ô –†–ï–ó–£–õ–¨–¢–ê–¢ --- */}
         {step === 'result' && (
            <div className="space-y-8 py-6 animate-in zoom-in duration-500 max-w-3xl mx-auto">
               <div className="bg-amber-50 border-2 border-amber-200 p-8 rounded-[32px] shadow-inner">
                  <h3 className="text-2xl font-black text-amber-800 mb-4 flex items-center gap-2">
                     <span>üìã</span> –î–∏–∞–≥–Ω–æ–∑ –≤–∞—à–µ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞:
                  </h3>
                  <p className="text-amber-900 text-xl font-medium leading-relaxed">{diagnosis}</p>
               </div>

               <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <div className="p-8 bg-white border border-gray-200 rounded-3xl shadow-sm">
                     <h4 className="font-black text-blue-600 mb-4 uppercase text-sm tracking-widest">–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥:</h4>
                     <p className="text-gray-600 font-medium">–°–æ–≥–ª–∞—Å–Ω–æ –∫–∞—Ä—Ç–µ, –≤–∞–º –Ω—É–∂–Ω–æ —Å—Ñ–æ–∫—É—Å–∏—Ä–æ–≤–∞—Ç—å—Å—è –Ω–∞ —ç—Ç–æ–π –∑–∞–¥–∞—á–µ, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏—Ç—å x2 –≤ –≤—ã—Ä—É—á–∫–µ.</p>
                  </div>
                  <div className="p-8 bg-gradient-to-br from-blue-600 to-indigo-700 text-white rounded-3xl shadow-xl flex flex-col justify-between">
                     <div>
                        <h4 className="font-black mb-2 uppercase text-sm tracking-widest opacity-80">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º:</h4>
                        <p className="text-lg font-bold leading-tight mb-6">{recommendation.title}</p>
                     </div>
                     <button
                        onClick={onComplete}
                        className="w-full bg-white text-blue-600 font-black py-4 rounded-xl shadow-lg hover:bg-blue-50 transition-colors"
                     >
                        {recommendation.action}
                     </button>
                  </div>
               </div>
            </div>
         )}
      </div>
   );
};

--- src/components/Results/AnomalyTable.tsx ---
// src/components/Results/AnomalyTable.tsx
import React, { useState } from 'react';
import { useAppStore } from '../../store/appStore';
import { PaywallModal } from './PaywallModal';

export const AnomalyTable: React.FC = () => {
   const { csvAnalysis } = useAppStore();
   const [showPaywall, setShowPaywall] = useState(false);

   if (!csvAnalysis || csvAnalysis.anomalies.length === 0) return null;

   const formatCurrency = (val: number) =>
      new Intl.NumberFormat('ru-RU', {
         style: 'currency',
         currency: 'RUB',
         maximumFractionDigits: 0,
      }).format(val);

   return (
      <div className="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden mt-6">
         <PaywallModal isOpen={showPaywall} onClose={() => setShowPaywall(false)} />

         <div className="p-6 border-b border-gray-100 bg-red-50 flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
            <div>
               <h3 className="text-lg font-bold text-red-800 flex items-center gap-2">
                  <span>‚ö†Ô∏è</span> –ù–∞–π–¥–µ–Ω–æ –∞–Ω–æ–º–∞–ª–∏–π: {csvAnalysis.anomalyCount}
               </h3>
               <p className="text-sm text-red-600 mt-1">
                  –û–±—â–∏–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª:{' '}
                  <span className="font-bold">
                     {formatCurrency(csvAnalysis.potentialRecoveryTotal)}
                  </span>{' '}
                  –≤ –≥–æ–¥
               </p>
            </div>
            <button
               onClick={() => setShowPaywall(true)}
               className="flex items-center gap-2 bg-white border border-red-200 text-red-700 px-4 py-2 rounded-xl text-sm font-bold hover:bg-red-100 transition-colors shadow-sm"
            >
               <span>üìÑ</span> –°–∫–∞—á–∞—Ç—å PDF –æ—Ç—á–µ—Ç
            </button>
         </div>

         <div className="overflow-x-auto">
            <table className="w-full text-left text-sm">
               <thead className="bg-gray-50 text-gray-600 font-medium">
                  <tr>
                     <th className="px-6 py-3">–ö–ª–∏–µ–Ω—Ç</th>
                     <th className="px-6 py-3">–¢–µ–∫. —Ü–µ–Ω–∞</th>
                     <th className="px-6 py-3">–û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ</th>
                     <th className="px-6 py-3 text-right">–ü–æ—Ç–µ–Ω—Ü–∏–∞–ª (–≥–æ–¥)</th>
                  </tr>
               </thead>
               <tbody className="divide-y divide-gray-100">
                  {csvAnalysis.anomalies.slice(0, 5).map((anomaly, idx) => (
              <tr key={idx} className="hover:bg-gray-50 transition-colors">
                <td className="px-6 py-4 font-medium text-gray-900">
                  {anomaly.customerName}
                </td>
                <td className="px-6 py-4">
                  {formatCurrency(anomaly.currentPrice)}
                </td>
                <td className="px-6 py-4">
                  <span
                    className={px-2 py-1 rounded-full text-xs font-bold ${
                      anomaly.severity === 'high'
                        ? 'bg-red-100 text-red-700'
                        : 'bg-orange-100 text-orange-700'
                    }}
                  >
                    -{anomaly.deviationPercent.toFixed(0)}%
                  </span>
                </td>
                <td className="px-6 py-4 text-right font-bold text-green-600">
                  +{formatCurrency(anomaly.potentialRecovery)}
                </td>
              </tr>
            ))}
            </tbody>
         </table>
         {csvAnalysis.anomalies.length > 5 && (
            <div className="p-4 bg-gray-50 text-center border-t border-gray-100">
               <button
                  onClick={() => setShowPaywall(true)}
                  className="text-blue-600 font-bold text-xs hover:underline uppercase tracking-widest"
               >
                  –ü–æ–∫–∞–∑–∞—Ç—å –µ—â–µ {csvAnalysis.anomalies.length - 5} –∞–Ω–æ–º–∞–ª–∏–π
               </button>
            </div>
         )}
      </div>
    </div >
  );
};

--- src/components/Results/ExportSection.tsx ---
// src/components/Results/ExportSection.tsx
import React from 'react';
import type { ReportData } from '../../core/types';

interface ExportSectionProps {
   reportData: ReportData;
   isPremium: boolean;
}

export const ExportSection: React.FC<ExportSectionProps> = ({
   reportData,
   isPremium,
}) => {
   return (
      <div className="bg-blue-600 p-8 rounded-3xl text-white shadow-xl flex justify-between items-center">
         <div>
            <h3 className="text-xl font-bold">
               –û—Ç—á–µ—Ç –¥–ª—è {reportData.brandName} –≥–æ—Ç–æ–≤
            </h3>
            <p className="text-blue-100">
               {isPremium
                  ? '–í–∞—à –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π PDF –¥–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è'
                  : '–û–±–Ω–æ–≤–∏—Ç–µ—Å—å –¥–æ PRO, —á—Ç–æ–±—ã —Å–∫–∞—á–∞—Ç—å –¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑'}
            </p>
         </div>
         <button className="bg-white text-blue-600 px-8 py-3 rounded-xl font-black hover:bg-blue-50 transition-colors">
            {isPremium ? '–°–ö–ê–ß–ê–¢–¨ PDF' : '–ö–£–ü–ò–¢–¨ PRO'}
         </button>
      </div>
   );
};
const { selectedPlaybook, setSelectedPlaybook } = useAppStore();

return (
   <div className="space-y-6">
      <div className="grid gap-4">
         {PRICING_PLAYBOOKS.map((playbook) => (
            <div
               key={playbook.id}
               onClick={() => setSelectedPlaybook(playbook)}
               className={p - 6 border-2 rounded-2xl cursor-pointer transition-all ${
              selectedPlaybook?.id === playbook.id
                  ? 'border-blue-600 bg-blue-50 shadow-lg'
                  : 'border-gray-200 bg-white hover:border-blue-300'
               }}
          >
         <h3 className="text-lg font-bold text-gray-900">
            {playbook.title}
         </h3>
         <p className="text-sm text-gray-600 mt-2">{playbook.description}</p>
         <div className="mt-4 flex flex-wrap gap-2">
            {playbook.strategicTips.slice(0, 2).map((tip, idx) => (
               <span
                  key={idx}
                  className="text-xs bg-gray-100 text-gray-700 px-3 py-1 rounded-full"
               >
                  {tip.category}
               </span>
            ))}
         </div>
      </div>
        ))}
   </div>

      {
   selectedPlaybook && (
      <div className="p-6 bg-blue-50 border-2 border-blue-200 rounded-2xl">
         <h4 className="font-bold text-blue-900 mb-4">
            –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ —Ü–µ–Ω:
         </h4>
         <div className="space-y-3">
            {selectedPlaybook.recommendedTiers.map((tier, idx) => (
               <div
                  key={idx}
                  className="flex justify-between items-center p-3 bg-white rounded-lg"
               >
                  <div>
                     <p className="font-bold text-gray-900">{tier.name}</p>
                     <p className="text-xs text-gray-600">
                        {tier.targetCustomer}
                     </p>
                  </div>
                  <p className="font-bold text-blue-600">{tier.priceRange}</p>
               </div>
            ))}
         </div>
      </div>
   )
}
    </div >
  );
};

export default PlaybookSelector;

--- src/components/Results/PaywallModal.tsx ---
// src/components/Results/PaywallModal.tsx
import React from 'react';

interface PaywallModalProps {
   isOpen: boolean;
   onClose: () => void;
}

export const PaywallModal: React.FC<PaywallModalProps> = ({ isOpen, onClose }) => {
   if (!isOpen) return null;

   return (
      <div className="fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/60 backdrop-blur-sm">
         <div className="bg-white rounded-3xl max-w-md w-full overflow-hidden shadow-2xl animate-in fade-in zoom-in duration-300">
            <div className="bg-blue-600 p-8 text-center text-white relative">
               <button onClick={onClose} className="absolute top-4 right-4 text-white/80 hover:text-white text-2xl">&times;</button>
               <div className="text-5xl mb-4">üìÑ</div>
               <h3 className="text-2xl font-black">PRO –û—Ç—á–µ—Ç</h3>
               <p className="text-blue-100 mt-2">–≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –≤–æ–∑–≤—Ä–∞—Ç–∞ –ø—Ä–∏–±—ã–ª–∏ –≤ PDF</p>
            </div>

            <div className="p-8">
               <ul className="space-y-4 mb-8">
                  <li className="flex items-center gap-3 text-gray-700">
                     <span className="text-green-500 font-bold">‚úì</span> –ü–æ—Å—Ç—Ä–æ—á–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤
                  </li>
                  <li className="flex items-center gap-3 text-gray-700">
                     <span className="text-green-500 font-bold">‚úì</span> –ì—Ä–∞—Ñ–∏–∫–∏ —ç–ª–∞—Å—Ç–∏—á–Ω–æ—Å—Ç–∏ –¥–ª—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π
                  </li>
                  <li className="flex items-center gap-3 text-gray-700">
                     <span className="text-green-500 font-bold">‚úì</span> –®–∞–±–ª–æ–Ω—ã –ø–∏—Å–µ–º –æ–± –∏–Ω–¥–µ–∫—Å–∞—Ü–∏–∏ —Ü–µ–Ω
                  </li>
               </ul>

               <div className="bg-gray-50 p-4 rounded-2xl mb-6 flex justify-between items-center border border-gray-100">
                  <div>
                     <p className="text-xs text-gray-500 uppercase font-bold tracking-wider">–¢–∞—Ä–∏—Ñ PRO</p>
                     <p className="text-2xl font-black text-gray-900">2 900 ‚ÇΩ <span className="text-sm font-normal text-gray-500">/ –º–µ—Å</span></p>
                  </div>
                  <div className="bg-blue-100 text-blue-700 px-3 py-1 rounded-full text-xs font-bold">-30% —Å–µ–≥–æ–¥–Ω—è</div>
               </div>

               <button
                  className="w-full bg-blue-600 text-white py-4 rounded-xl font-bold text-lg hover:bg-blue-700 transition-all shadow-lg active:scale-95"
                  onClick={() => alert('–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —ç–∫–≤–∞–π—Ä–∏–Ω–≥–æ–º –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ. –°–ø–∞—Å–∏–±–æ –∑–∞ –∏–Ω—Ç–µ—Ä–µ—Å –∫ MVP!')}
               >
                  –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —ç–∫—Å–ø–æ—Ä—Ç
               </button>
               <p className="text-center text-xs text-gray-400 mt-4">–û–ø–ª–∞—Ç–∞ –∫–∞—Ä—Ç–æ–π –†–§ / –°–ë–ü / –°—á–µ—Ç –¥–ª—è —é—Ä–ª–∏—Ü</p>
            </div>
         </div>
      </div>
   );
};

--- src/components/Results/RevenueChart.tsx ---
// src/components/Results/RevenueChart.tsx
import React from 'react';
import {
   BarChart,
   Bar,
   XAxis,
   YAxis,
   CartesianGrid,
   Tooltip,
   Legend,
   ResponsiveContainer,
   Cell,
} from 'recharts';
import { useAppStore } from '../../store/appStore';

export const RevenueChart: React.FC = () => {
   const { revenueLiftResults } = useAppStore();

   if (!revenueLiftResults) {
      return (
         <div className="h-64 flex items-center justify-center border-2 border-dashed rounded-lg text-gray-400">
            –ù–∞–∂–º–∏—Ç–µ ¬´–†–∞—Å—Å—á–∏—Ç–∞—Ç—å¬ª, —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –ø—Ä–æ–≥–Ω–æ–∑
         </div>
      );
   }

   const data = [
      {
         name: '–¢–µ–∫—É—â–∞—è –≤—ã—Ä—É—á–∫–∞',
         value: revenueLiftResults.currentAnnualRevenue,
         color: '#94a3b8',
      },
      {
         name: '–ü—Ä–æ–≥–Ω–æ–∑ –≤—ã—Ä—É—á–∫–∏',
         value: revenueLiftResults.newAnnualRevenue,
         color: '#2563eb',
      },
   ];

   // –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ —Ä—É–±–ª–∏
   const formatCurrency = (value: number) =>
      new Intl.NumberFormat('ru-RU', {
         style: 'currency',
         currency: 'RUB',
         maximumFractionDigits: 0,
      }).format(value);

   // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–Ω–∞–∫–∞
   const getSign = (value: number) => (value > 0 ? '+' : '');

   return (
    <div className="bg-white p-6 rounded-lg shadow-lg">
      <h3 className="text-lg font-bold mb-4 text-gray-800">
        –ì–æ–¥–æ–≤–æ–π Revenue Lift
      </h3>
      <div className="h-80 w-full">
        <ResponsiveContainer width="100%" height="100%">
          <BarChart data={data}>
            <CartesianGrid strokeDasharray="3 3" vertical={false} />
            <XAxis dataKey="name" />
            <YAxis
              tickFormatter={(val) => ${(val / 1000).toFixed(0)}k ‚ÇΩ}
            />
            <Tooltip
              formatter={(value: number | string | undefined) => {
                if (value === undefined) return '';
                return typeof value === 'number' ? formatCurrency(value) : value;
              }}
            />
            <Legend />
            <Bar
              dataKey="value"
              name="–í—ã—Ä—É—á–∫–∞ (‚ÇΩ –≤ –≥–æ–¥)"
              radius={[4, 4, 0, 0]}
            >
              {data.map((entry, index) => (
                <Cell key={cell-${index}} fill={entry.color} />
              ))}
            </Bar>
          </BarChart>
        </ResponsiveContainer>
      </div>

      <div
        className={mt-4 p-4 rounded-lg border ${
          revenueLiftResults.revenueLift >= 0
            ? 'bg-blue-50 border-blue-100'
            : 'bg-red-50 border-red-100'
        }}
      >
        <p
          className={${
            revenueLiftResults.revenueLift >= 0
              ? 'text-blue-800'
              : 'text-red-800'
          } font-medium}
        >
          –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π —Ä–æ—Å—Ç:
          <span className="font-bold ml-1">
            {getSign(revenueLiftResults.revenueLiftPercent)}
            {revenueLiftResults.revenueLiftPercent.toFixed(1)}%
          </span>
        </p>
        <p
          className={${
            revenueLiftResults.revenueLift >= 0
              ? 'text-blue-600'
              : 'text-red-600'
          } text-sm}
        >
   –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–∏–±—ã–ª—å:
<span className="ml-1">
   {getSign(revenueLiftResults.revenueLift)}
   {formatCurrency(revenueLiftResults.revenueLift)} –≤ –≥–æ–¥
</span>
        </p >
      </div >
    </div >
  );
};

--- src/core/elasticity.ts ---
// src/core/elasticity.ts
import type { ElasticityModel } from './types';

/**
 * –ú–æ–¥–µ–ª–∏ —ç–ª–∞—Å—Ç–∏—á–Ω–æ—Å—Ç–∏ —Å–ø—Ä–æ—Å–∞ –ø–æ –æ—Ç—Ä–∞—Å–ª—è–º
 * –ò—Å—Ç–æ—á–Ω–∏–∫: McKinsey, Bain pricing studies
 */
export const ELASTICITY_MODELS: Record<string, ElasticityModel> = {
   // SaaS: –±–æ–ª–µ–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã –∫ —Ü–µ–Ω–µ, –º–Ω–æ–≥–æ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
   saas_low: {
      industry: 'saas',
      priceElasticity: -0.8, // 1% —Ä–æ—Å—Ç —Ü–µ–Ω—ã = 0.8% –ø–∞–¥–µ–Ω–∏–µ —Å–ø—Ä–æ—Å–∞
      demandCurve: (price: number) => 1000 * Math.pow(price, -0.8),
   },
   saas_medium: {
      industry: 'saas',
      priceElasticity: -1.2,
      demandCurve: (price: number) => 1000 * Math.pow(price, -1.2),
   },
   saas_high: {
      industry: 'saas',
      priceElasticity: -1.8,
      demandCurve: (price: number) => 1000 * Math.pow(price, -1.8),
   },

   // Agency: —Å—Ä–µ–¥–Ω—è—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –µ—Å—Ç—å –ª–æ—è–ª—å–Ω–æ—Å—Ç—å
   agency_low: {
      industry: 'agency',
      priceElasticity: -0.6,
      demandCurve: (price: number) => 500 * Math.pow(price, -0.6),
   },
   agency_medium: {
      industry: 'agency',
      priceElasticity: -1.0,
      demandCurve: (price: number) => 500 * Math.pow(price, -1.0),
   },

   // Infrastructure: –Ω–∏–∑–∫–∞—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –≤—ã—Å–æ–∫–∏–µ switching costs
   infrastructure_low: {
      industry: 'infrastructure',
      priceElasticity: -0.4,
      demandCurve: (price: number) => 2000 * Math.pow(price, -0.4),
   },
   infrastructure_medium: {
      industry: 'infrastructure',
      priceElasticity: -0.7,
      demandCurve: (price: number) => 2000 * Math.pow(price, -0.7),
   },
};

/**
 * –í—ã–±–æ—Ä –º–æ–¥–µ–ª–∏ —ç–ª–∞—Å—Ç–∏—á–Ω–æ—Å—Ç–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Ç—Ä–∞—Å–ª–∏ –∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç–∏
 */
export const selectElasticityModel = (
   industry: 'saas' | 'agency' | 'infrastructure',
   competitiveness: 'low' | 'medium' | 'high'
): ElasticityModel => {
   const key = ${ industry }_${ competitiveness };
   return ELASTICITY_MODELS[key] || ELASTICITY_MODELS['saas_medium'];
};

/**
 * –†–∞—Å—á–µ—Ç –∫—Ä–∏–≤–æ–π —Å–ø—Ä–æ—Å–∞
 */
export const generateDemandCurve = (
   elasticityModel: ElasticityModel,
   priceRange: { min: number; max: number },
   steps: number = 50
): Array<{ price: number; demand: number }> => {
   const step = (priceRange.max - priceRange.min) / steps;
   const curve = [];

   for (let price = priceRange.min; price <= priceRange.max; price += step) {
      curve.push({
         price: Math.round(price * 100) / 100,
         demand: elasticityModel.demandCurve(price),
      });
   }

   return curve;
};

/**
 * –†–∞—Å—á–µ—Ç —Ç–æ—á–∫–∏ –º–∞–∫—Å–∏–º–∏–∑–∞—Ü–∏–∏ –≤—ã—Ä—É—á–∫–∏ –Ω–∞ –∫—Ä–∏–≤–æ–π —Å–ø—Ä–æ—Å–∞
 */
export const findRevenueMaximizingPrice = (
   elasticityModel: ElasticityModel,
   basePrice: number,
   priceRange: { min: number; max: number }
): { optimalPrice: number; maxRevenue: number } => {
   const curve = generateDemandCurve(elasticityModel, priceRange, 100);

   let maxRevenue = 0;
   let optimalPrice = basePrice;

   curve.forEach(({ price, demand }) => {
      const revenue = price * demand;
      if (revenue > maxRevenue) {
         maxRevenue = revenue;
         optimalPrice = price;
      }
   });

   return { optimalPrice, maxRevenue };
};

/**
 * –ê–Ω–∞–ª–∏–∑ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ü–µ–Ω—ã
 */
export const priceElasticityAnalysis = (
   basePrice: number,
   baseDemand: number,
   elasticity: number,
   priceChangePercent: number
): {
   newPrice: number;
   newDemand: number;
   revenueChange: number;
   elasticity: number;
} => {
   const newPrice = basePrice * (1 + priceChangePercent);
   const demandChange = elasticity * priceChangePercent;
   const newDemand = baseDemand * (1 + demandChange);

   const currentRevenue = basePrice * baseDemand;
   const newRevenue = newPrice * newDemand;
   const revenueChange = ((newRevenue - currentRevenue) / currentRevenue) * 100;

   return {
      newPrice,
      newDemand,
      revenueChange,
      elasticity,
   };
};

--- src/core/inflation.ts ---
// src/core/inflation.ts

export interface InflationAdjustment {
   suggestedPrice: number;
   adjustmentPercentage: number;
   reasoning: string;
}

export function suggestPriceAdjustment(
   currentPrice: number,
   lastUpdateDate: Date,
   sector: string = 'IT Services',
   region: string = 'US'
): InflationAdjustment {
   // –ë–∞–∑–æ–≤–∞—è –ª–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ (–º–æ–∂–Ω–æ —É—Å–ª–æ–∂–Ω–∏—Ç—å –ø–æ–∑–∂–µ)
   const yearsPassed =
      new Date().getFullYear() - lastUpdateDate.getFullYear();
   const avgInflation = 0.045; // 4.5% –≤ –≥–æ–¥
   const adjustmentPercentage = Math.max(
      0,
      yearsPassed * avgInflation * 100
   );
   const suggestedPrice =
      currentPrice * (1 + adjustmentPercentage / 100);

   return {
      suggestedPrice: Math.round(suggestedPrice * 100) / 100,
      adjustmentPercentage,
      reasoning: –ù–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö –ø–æ –∏–Ω—Ñ–ª—è—Ü–∏–∏ –≤ —Å–µ–∫—Ç–æ—Ä–µ ${ sector } (${ region }), —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –Ω–∞ ${ adjustmentPercentage.toFixed(1) }%.,
  };
}

--- src/core/ltv.ts ---
// src/core/ltv.ts
import type { LTVProjection, PricingModel } from './types';

/**
 * –†–∞—Å—á–µ—Ç Customer Lifetime Value (LTV)
 *
 * –§–æ—Ä–º—É–ª–∞:
 * LTV = ARPU * Gross Margin * Customer Lifetime (–≤ –º–µ—Å—è—Ü–∞—Ö)
 * –≥–¥–µ Customer Lifetime = 1 / Monthly Churn Rate
 */
export const calculateLTV = (
   monthlyRevenue: number,
   monthlyChurnRate: number, // 0.05 = 5% –≤ –º–µ—Å—è—Ü
   grossMarginPercent: number = 80
): LTVProjection => {
   // –†–∞—Å—á–µ—Ç —Å—Ä–µ–¥–Ω–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏ –∫–ª–∏–µ–Ω—Ç–∞ –≤ –º–µ—Å—è—Ü–∞—Ö
   const customerLifetime = 1 / monthlyChurnRate;

   // –í–∞–ª–æ–≤–∞—è –ø—Ä–∏–±—ã–ª—å
   const grossMargin = (monthlyRevenue * grossMarginPercent) / 100;

   // LTV = –°—Ä–µ–¥–Ω–µ–º–µ—Å—è—á–Ω–∞—è –ø—Ä–∏–±—ã–ª—å * –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫–ª–∏–µ–Ω—Ç–∞
   const totalLTV = grossMargin * customerLifetime;

   return {
      model: 'flat_fee',
      monthlyRevenue,
      customerLifetime,
      totalLTV,
      marginAfterCAC: 0,
      paybackPeriod: 0,
   };
};

/**
 * –°—Ä–∞–≤–Ω–µ–Ω–∏–µ LTV –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –º–æ–¥–µ–ª–µ–π –ø—Ä–∞–π—Å–∏–Ω–≥–∞
 */
export const compareLTVModels = (
   flatFeePrice: number,
   perSeatPrice: number,
   averageSeatsPerCustomer: number,
   usageBasedPrice: number,
   averageUsagePerCustomer: number,
   monthlyChurnRate: number,
   customerAcquisitionCost: number,
   grossMarginPercent: number = 80
): {
   flatFee: LTVProjection & { paybackMonths: number };
   perSeat: LTVProjection & { paybackMonths: number };
   usageBased: LTVProjection & { paybackMonths: number };
} => {
   // Flat Fee –º–æ–¥–µ–ª—å
   const flatFeeRevenue = flatFeePrice;
   const flatFeeLTV = calculateLTV(
      flatFeeRevenue,
      monthlyChurnRate,
      grossMarginPercent
   );
   const flatFeePayback =
      customerAcquisitionCost / (flatFeeRevenue * (grossMarginPercent / 100));

   // Per Seat –º–æ–¥–µ–ª—å
   const perSeatRevenue = perSeatPrice * averageSeatsPerCustomer;
   const perSeatLTV = calculateLTV(
      perSeatRevenue,
      monthlyChurnRate,
      grossMarginPercent
   );
   const perSeatPayback =
      customerAcquisitionCost / (perSeatRevenue * (grossMarginPercent / 100));

   // Usage-Based –º–æ–¥–µ–ª—å
   const usageRevenue = usageBasedPrice * averageUsagePerCustomer;
   const usageLTV = calculateLTV(
      usageRevenue,
      monthlyChurnRate,
      grossMarginPercent
   );
   const usagePayback =
      customerAcquisitionCost / (usageRevenue * (grossMarginPercent / 100));

   return {
      flatFee: {
         ...flatFeeLTV,
         model: 'flat_fee',
         paybackPeriod: flatFeePayback,
         marginAfterCAC: flatFeeLTV.totalLTV - customerAcquisitionCost,
         paybackMonths: flatFeePayback,
      },
      perSeat: {
         ...perSeatLTV,
         model: 'per_seat',
         paybackPeriod: perSeatPayback,
         marginAfterCAC: perSeatLTV.totalLTV - customerAcquisitionCost,
         paybackMonths: perSeatPayback,
      },
      usageBased: {
         ...usageLTV,
         model: 'usage_based',
         paybackPeriod: usagePayback,
         marginAfterCAC: usageLTV.totalLTV - customerAcquisitionCost,
         paybackMonths: usagePayback,
      },
   };
};

/**
 * –†–∞—Å—á–µ—Ç –≤–ª–∏—è–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω—ã –Ω–∞ LTV
 */
export const calculateLTVImpact = (
   currentPrice: number,
   newPrice: number,
   monthlyChurnRate: number,
   customerAcquisitionCost: number,
   priceElasticity: number = -1.0
): {
   currentLTV: number;
   newLTV: number;
   ltvIncrease: number;
   paybackPeriodChange: number;
} => {
   const currentLTV = calculateLTV(currentPrice, monthlyChurnRate).totalLTV;

   // –ü—Ä–∏ –ø–æ–≤—ã—à–µ–Ω–∏–∏ —Ü–µ–Ω—ã –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è churn
   const priceChangePercent = (newPrice - currentPrice) / currentPrice;
   const churnIncrease = Math.abs(priceChangePercent * priceElasticity * 0.01);
   const newChurnRate = Math.min(monthlyChurnRate + churnIncrease, 0.15); // –º–∞–∫—Å 15% churn

   const newLTV = calculateLTV(newPrice, newChurnRate).totalLTV;

   const currentPayback = customerAcquisitionCost / (currentPrice * 0.8);
   const newPayback = customerAcquisitionCost / (newPrice * 0.8);

   return {
      currentLTV,
      newLTV,
      ltvIncrease: newLTV - currentLTV,
      paybackPeriodChange: newPayback - currentPayback,
   };
};

/**
 * –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è LTV —á–µ—Ä–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏ –ø—Ä–∞–π—Å–∏–Ω–≥–∞
 */
export const optimizeLTVByModel = (
   currentMonthlyRevenue: number,
   monthlyChurnRate: number,
   customerAcquisitionCost: number,
   models: PricingModel[]
): {
   model: PricingModel;
   ltv: number;
   paybackMonths: number;
   recommendation: string;
}[] => {
   return models
      .map((model) => {
         const ltv = calculateLTV(currentMonthlyRevenue, monthlyChurnRate)
            .totalLTV;
         const payback = customerAcquisitionCost / (currentMonthlyRevenue * 0.8);

         return {
            model,
            ltv,
            paybackMonths: payback,
            recommendation: payback < 12 ? '–û—Ç–ª–∏—á–Ω—ã–π –≤—ã–±–æ—Ä' : '–¢—Ä–µ–±—É–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏',
         };
      })
      .sort((a, b) => b.ltv - a.ltv);
};

--- src/core/playbooks.ts ---
/* src/core/playbooks.ts */
import type { PricingPlaybook, PricingTier, PlaybookTip } from './types'; // –î–æ–±–∞–≤–ª–µ–Ω–æ —Å–ª–æ–≤–æ type

const SAAS_TIERS: PricingTier[] = [
   { name: 'Starter', features: ['Core functionality', 'Up to 5 users'], priceRange: '$29-49/mo', targetCustomer: 'Small teams' },
   { name: 'Professional', features: ['Priority support', 'API access'], priceRange: '$99-199/mo', targetCustomer: 'Growing businesses' },
   { name: 'Enterprise', features: ['Custom SLA', 'SSO/SAML'], priceRange: '$499+/mo', targetCustomer: 'Large orgs' }
];

const SAAS_TIPS: PlaybookTip[] = [
   { category: 'Psychology', advice: 'Use $99 instead of $100 for conversion', source: 'Bain' },
   { category: 'Strategy', advice: 'Align price with value metrics, not costs', source: 'McKinsey' }
];

export const PRICING_PLAYBOOKS: PricingPlaybook[] = [
   {
      id: 'saas-subscription',
      category: 'SaaS',
      title: 'SaaS Subscription Model',
      description: 'Tiered pricing optimized for B2B SaaS.',
      recommendedTiers: SAAS_TIERS,
      strategicTips: SAAS_TIPS,
      pricingModel: 'subscription'
   }
   // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å Agency –∏ Infrastructure –ø–æ –∞–Ω–∞–ª–æ–≥–∏–∏
];

export const getPlaybookByCategory = (cat: string) => PRICING_PLAYBOOKS.find(p => p.category === cat);

--- src/core/pricing.ts ---
// src/core/pricing.ts
import type { PricingScenario, RevenueLiftResult, ElasticityModel } from './types';

/**
 * –†–∞—Å—á–µ—Ç –ø—Ä–∏—Ä–æ—Å—Ç–∞ –≤—ã—Ä—É—á–∫–∏ –∏ –ø—Ä–∏–±—ã–ª–∏ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Ü–µ–Ω—ã —Å —É—á–µ—Ç–æ–º CAC
 */
export const calculateRevenueLift = (
   scenario: PricingScenario,
   elasticityModel: ElasticityModel
): RevenueLiftResult => {
   const {
      currentPrice,
      newPrice,
      currentCustomers,
      averageChurn,
      customerAcquisitionCost,
   } = scenario;

   const priceChangePercent = (newPrice - currentPrice) / currentPrice;

   // –†–∞—Å—á–µ—Ç —ç–ª–∞—Å—Ç–∏—á–Ω–æ—Å—Ç–∏ —Å–ø—Ä–æ—Å–∞
   const customerLossPercent = Math.abs(
      priceChangePercent * elasticityModel.priceElasticity
   );

   // –£—á–∏—Ç—ã–≤–∞–µ–º –±–∞–∑–æ–≤—ã–π –º–µ—Å—è—á–Ω—ã–π –æ—Ç—Ç–æ–∫ –∏ –ø–æ—Ç–µ—Ä—é –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω—ã
   const totalChurn = averageChurn / 100 / 12 + customerLossPercent;
   const newCustomerCount = Math.max(
      currentCustomers * (1 - totalChurn),
      currentCustomers * 0.5
   );

   // –í–∞–ª–æ–≤–∞—è –≤—ã—Ä—É—á–∫–∞ (Annual Revenue)
   const currentAnnualRevenue = currentPrice * currentCustomers * 12;
   const newAnnualRevenue = newPrice * newCustomerCount * 12;

   // –£—á–µ—Ç –∑–∞—Ç—Ä–∞—Ç –Ω–∞ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ (CAC)
   const currentTotalCAC = currentCustomers * customerAcquisitionCost;
   const newTotalCAC = newCustomerCount * customerAcquisitionCost;

   const revenueLift = newAnnualRevenue - currentAnnualRevenue;

   return {
      currentAnnualRevenue,
      newAnnualRevenue,
      revenueLift,
      revenueLiftPercent:
         currentAnnualRevenue > 0
            ? (revenueLift / currentAnnualRevenue) * 100
            : 0,
      customerChurnImpact: currentCustomers - newCustomerCount,
      netGain: revenueLift > 0 ? revenueLift : 0,
      breakEvenCustomers: currentAnnualRevenue / (newPrice * 12),
      netProfitImpact:
         newAnnualRevenue - newTotalCAC - (currentAnnualRevenue - currentTotalCAC),
   };
};

/**
 * –†–∞—Å—á–µ—Ç –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–π —Ü–µ–Ω—ã
 */
export const findOptimalPrice = (
   basePrice: number,
   currentCustomers: number,
   priceElasticity: number,
   priceRange: { min: number; max: number } = {
      min: basePrice * 0.5,
      max: basePrice * 2,
   }
): { optimalPrice: number; maxRevenue: number } => {
   let maxRevenue = 0;
   let optimalPrice = basePrice;

   const step = (priceRange.max - priceRange.min) / 100;

   for (let price = priceRange.min; price <= priceRange.max; price += step) {
      const priceChangePercent = (price - basePrice) / basePrice;
      const demandDrop = Math.abs(priceChangePercent * priceElasticity);
      const revenue = price * (currentCustomers * (1 - demandDrop)) * 12;

      if (revenue > maxRevenue) {
         maxRevenue = revenue;
         optimalPrice = price;
      }
   }

   return { optimalPrice, maxRevenue };
};

/**
 * –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
 */
export const compareScenarios = (
   scenarios: PricingScenario[],
   elasticityModel: ElasticityModel
): RevenueLiftResult[] => {
   return scenarios.map((scenario) =>
      calculateRevenueLift(scenario, elasticityModel)
   );
};

--- src/core/types.ts ---
// src/core/types.ts

/**
 * ========== PRICING PLAYBOOKS ==========
 */
export interface PricingTier {
   name: string;
   features: string[];
   priceRange: string;
   targetCustomer: string;
}

export interface PlaybookTip {
   category: string;
   advice: string;
   source: 'McKinsey' | 'Bain' | 'BCG';
}

export interface PricingPlaybook {
   id: string;
   category: 'SaaS' | 'Agency' | 'Infrastructure';
   title: string;
   description: string;
   recommendedTiers: PricingTier[];
   strategicTips: PlaybookTip[];
   pricingModel: 'subscription' | 'usage-based' | 'value-based' | 'hybrid';
}

/**
 * ========== ELASTICITY MODELS ==========
 */
export interface ElasticityModel {
   industry: string;
   priceElasticity: number;
   demandCurve: (price: number) => number;
}

/**
 * ========== PRICING SCENARIOS & RESULTS ==========
 */
export interface PricingScenario {
   currentPrice: number;
   newPrice: number;
   currentCustomers: number;
   customerAcquisitionCost: number;
   averageContractLength: number;
   priceElasticity?: number;
   averageChurn: number;
}

export interface RevenueLiftResult {
   currentAnnualRevenue: number;
   newAnnualRevenue: number;
   revenueLift: number;
   revenueLiftPercent: number;
   customerChurnImpact: number;
   netGain: number;
   breakEvenCustomers: number;
   netProfitImpact?: number;
}

/**
 * ========== PRICING DATA & REPORTS ==========
 */
export interface PricingData {
   currentPrice: number;
   currentCustomers?: number;
   customerAcquisitionCost?: number;
   averageContractLength?: number;
   currency?: string;
   lastUpdateDate: Date;
}

export interface ReportData {
   brandName: string;
   currentPricing: {
      price: number;
      currency: string;
      lastUpdate: Date;
   };
   recommendedPricing: {
      price: number;
      adjustmentReason: string;
      inflationImpact: number;
   };
   selectedPlaybook?: PricingPlaybook;
   comparisonChart: {
      competitors: Array<{
         name: string;
         price: number;
         features: string[];
      }>;
   };
   generatedDate: Date;
}

/**
 * ========== LTV MODELS ==========
 */
export type PricingModel = 'flat_fee' | 'per_seat' | 'usage_based';

export interface LTVProjection {
   model: PricingModel;
   monthlyRevenue: number;
   customerLifetime: number;
   totalLTV: number;
   marginAfterCAC: number;
   paybackPeriod: number;
}

/**
 * ========== LEGACY (–¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏) ==========
 */
export interface CalculationResults extends RevenueLiftResult {
   suggestedPrice?: number;
   adjustmentPercentage?: number;
}

--- src/csv/anomaly.ts ---
// src/csv/anomaly.ts
import type { CSVRow, CSVAnalysisResult, AnomalyRecord } from './types';

export const analyzeCSVData = (rows: CSVRow[]): CSVAnalysisResult => {
   const prices = rows.map((r) => r.currentPrice).sort((a, b) => a - b);

   // –†–∞—Å—á–µ—Ç –º–µ–¥–∏–∞–Ω—ã
   const mid = Math.floor(prices.length / 2);
   const medianPrice =
      prices.length % 2 !== 0
         ? prices[mid]
         : (prices[mid - 1] + prices[mid]) / 2;

   const anomalies: AnomalyRecord[] = rows
      .filter((r) => r.currentPrice < medianPrice)
      .map((r, index) => ({
         rowIndex: index,
         customerId: r.customerId,
         customerName: r.customerName,
         currentPrice: r.currentPrice,
         medianPrice: medianPrice,
         priceDeviation: medianPrice - r.currentPrice,
         deviationPercent:
            ((medianPrice - r.currentPrice) / medianPrice) * 100,
         severity:
            (medianPrice - r.currentPrice) / medianPrice > 0.3
               ? 'high'
               : 'medium',
         potentialRecovery: medianPrice - r.currentPrice,
      }));

   const totalMRR = rows.reduce((sum, r) => sum + r.currentPrice, 0);

   return {
      totalCustomers: rows.length,
      totalMRR,
      totalARR: totalMRR * 12,
      medianPrice,
      averagePrice: totalMRR / rows.length,
      anomalies,
      anomalyCount: anomalies.length,
      potentialRecoveryTotal: anomalies.reduce(
         (sum, a) => sum + a.potentialRecovery,
         0
      ),
   };
};

--- src/csv/parser.ts ---
// src/csv/parser.ts
import type { ParsedCSVData, CSVRow } from './types';

export const loadAndParseCSVFile = async (
   file: File
): Promise<ParsedCSVData> => {
   const text = await file.text();
   const cleanText = text.replace(/^uFEFF/, '').trim();

   if (!cleanText) throw new Error('–§–∞–π–ª –ø—É—Å—Ç');

   const lines = cleanText
      .split(/\r?\n/)
      .map((l) => l.trim())
      .filter(Boolean);

   const delimiter = lines[0].includes(';') ? ';' : ',';
   const headers = lines[0]
      .split(delimiter)
      .map((h) => h.trim().replace(/^["']|["']$/g, ''));

   const rows: CSVRow[] = lines.slice(1).map((line) => {
      const values = line
         .split(delimiter)
         .map((v) => v.trim().replace(/^["']|["']$/g, ''));
      const row: any = {};

      headers.forEach((header, index) => {
         const val = values[index];
         // –ü—Ä–∏–≤–æ–¥–∏–º –∫ —á–∏—Å–ª—É –∫–æ–ª–æ–Ω–∫–∏, –∫–æ—Ç–æ—Ä—ã–µ –≤ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–µ CSVRow –∑–∞—è–≤–ª–µ–Ω—ã –∫–∞–∫ number
         if (['currentPrice', 'monthlyChurn', 'seats', 'usage'].includes(header)) {
            row[header] = val ? Number(val.replace(',', '.')) : 0;
         } else {
            row[header] = val || '';
         }
      });
      return row as CSVRow;
   });

   return {
      rows,
      totalRows: rows.length,
      validRows: rows.length,
      errors: [],
   };
};

--- src/csv/types.ts ---
// src/csv/types.ts

export interface CSVRow {
   customerId: string;
   customerName: string;
   currentPrice: number;
   monthlyChurn: number;
   contractStartDate: string;
   seats?: number;
   usage?: number;
   [key: string]: string | number | undefined;
}

export interface ParsedCSVData {
   rows: CSVRow[];
   totalRows: number;
   validRows: number;
   errors: CSVParseError[];
}

export interface CSVParseError {
   rowIndex: number;
   field: string;
   value: any;
   error: string;
}

export interface AnomalyRecord {
   rowIndex: number;
   customerId: string;
   customerName: string;
   currentPrice: number;
   medianPrice: number;
   priceDeviation: number;
   deviationPercent: number;
   severity: 'low' | 'medium' | 'high';
   potentialRecovery: number;
}

export interface CSVAnalysisResult {
   totalCustomers: number;
   totalMRR: number;
   totalARR: number;
   medianPrice: number;
   averagePrice: number;
   anomalies: AnomalyRecord[];
   anomalyCount: number;
   potentialRecoveryTotal: number;
}

--- src/csv/validator.ts ---
// src/csv/validator.ts
import type { CSVRow } from './types';

export interface ValidationResult {
   isValid: boolean;
   errors: string[];
   warnings: string[];
}

/**
 * –í–∞–ª–∏–¥–∞—Ü–∏—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö CSV –¥–∞–Ω–Ω—ã—Ö
 */
export const validateCSVData = (rows: CSVRow[]): ValidationResult => {
   const errors: string[] = [];
   const warnings: string[] = [];

   if (!rows || rows.length === 0) {
      errors.push('CSV —Ñ–∞–π–ª –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –¥–∞–Ω–Ω—ã—Ö');
      return { isValid: false, errors, warnings };
   }

   if (rows.length < 5) {
      warnings.push('–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –º–∏–Ω–∏–º—É–º 5 –∑–∞–ø–∏—Å–µ–π –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞');
   }

   rows.forEach((row, index) => {
      // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ customerId (–≤ —Ñ–∞–π–ª–µ C001, C002...)
      if (!row.customerId || String(row.customerId).trim() === '') {
         errors.push(`–°—Ç—Ä–æ–∫–∞ ${index + 2}: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç customerId`);
      }

      // 2. –ü—Ä–µ–≤—Ä–∞—â–∞–µ–º —Å—Ç—Ä–æ–∫—É –≤ —á–∏—Å–ª–æ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ü–µ–Ω—ã
      const price = Number(row.currentPrice);

      if (isNaN(price) || price <= 0) {
         errors.push(`–°—Ç—Ä–æ–∫–∞ ${index + 2}: –Ω–µ–≤–∞–ª–∏–¥–Ω–∞—è —Ü–µ–Ω–∞ "${row.currentPrice}" (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å —á–∏—Å–ª–æ–º –±–æ–ª—å—à–µ 0)`);
      } else {
         if (price > 1000000) {
            warnings.push(`–°—Ç—Ä–æ–∫–∞ ${index + 2}: –Ω–µ–æ–±—ã—á–Ω–æ –≤—ã—Å–æ–∫–∞—è —Ü–µ–Ω–∞ (${price})`);
         }
      }
   });

   // 3. –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π —Ä–∞—Å—á–µ—Ç —Ä–∞–∑–±—Ä–æ—Å–∞ —Ü–µ–Ω (—Ç–æ–ª—å–∫–æ –¥–ª—è –≤–∞–ª–∏–¥–Ω—ã—Ö —á–∏—Å–µ–ª)
   const validPrices = rows
      .map((r) => Number(r.currentPrice))
      .filter((p) => !isNaN(p) && p > 0);

   if (validPrices.length > 0) {
      const maxPrice = Math.max(...validPrices);
      const minPrice = Math.min(...validPrices);
      const ratio = maxPrice / minPrice;

      if (ratio > 100) {
         warnings.push(
            `–û—á–µ–Ω—å –±–æ–ª—å—à–æ–π —Ä–∞–∑–±—Ä–æ—Å —Ü–µ–Ω (${minPrice.toFixed(2)} - ${maxPrice.toFixed(2)}). –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞–ª—é—Ç—É –∏ –µ–¥–∏–Ω–∏—Ü—ã –∏–∑–º–µ—Ä–µ–Ω–∏—è.`
         );
      }
   }

   return {
      isValid: errors.length === 0,
      errors,
      warnings,
   };
};

/**
 * –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ —Ñ–∞–π–ª–∞
 */
export const validateFileFormat = (file: File): ValidationResult => {
   const errors: string[] = [];
   const warnings: string[] = [];

   const validExtensions = ['.csv']; // –î–ª—è MVP –æ—Å—Ç–∞–≤–∏–º —Ç–æ–ª—å–∫–æ CSV
   const fileName = file.name.toLowerCase();
   const hasValidExtension = validExtensions.some((ext) => fileName.endsWith(ext));

   if (!hasValidExtension) {
      errors.push('–ù–µ–ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ CSV.');
   }

   const maxSize = 10 * 1024 * 1024; // 10MB
   if (file.size > maxSize) {
      errors.push('–†–∞–∑–º–µ—Ä —Ñ–∞–π–ª–∞ –ø—Ä–µ–≤—ã—à–∞–µ—Ç 10MB');
   }

   if (file.size === 0) {
      errors.push('–í—ã–±—Ä–∞–Ω–Ω—ã–π —Ñ–∞–π–ª –ø—É—Å—Ç');
   }

   return {
      isValid: errors.length === 0,
      errors,
      warnings,
   };
};

--- src/hooks/useCSVParser.ts ---
// src/hooks/useCSVParser.ts
import { useState, useCallback } from 'react';
import { loadAndParseCSVFile } from '../csv/parser';
import { analyzeCSVData } from '../csv/anomaly';
import { validateCSVData } from '../csv/validator';
import type { CSVAnalysisResult, CSVRow } from '../csv/types';

export interface ParseResult {
   rows: CSVRow[];
   analysis: CSVAnalysisResult;
   errors: string[];
}

export const useCSVParser = () => {
   const [isLoading, setIsLoading] = useState(false);
   const [error, setError] = useState<string | null>(null);

   const parseFile = useCallback(
      async (file: File): Promise<ParseResult | null> => {
         setIsLoading(true);
         setError(null);

         try {
            const parsed = await loadAndParseCSVFile(file);

            const validation = validateCSVData(parsed.rows);
            if (!validation.isValid) {
               const errorMsg = validation.errors.join('; ');
               setError(errorMsg);
               return null;
            }

            const csvAnalysis = analyzeCSVData(parsed.rows);

            return {
               rows: parsed.rows,
               analysis: csvAnalysis,
               errors: validation.warnings,
            };
         } catch (err) {
            const message =
               err instanceof Error ? err.message : '–û—à–∏–±–∫–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ —Ñ–∞–π–ª–∞';
            setError(message);
            return null;
         } finally {
            setIsLoading(false);
         }
      },
      []
   );

   return {
      isLoading,
      error,
      parseFile,
   };
};

--- src/hooks/usePricingCalculations.ts ---
// src/hooks/usePricingCalculations.ts
import { useState, useCallback } from 'react';
import { calculateRevenueLift, findOptimalPrice } from '../core/pricing';
import { selectElasticityModel } from '../core/elasticity';
import type { PricingScenario, RevenueLiftResult } from '../core/types';

export const usePricingCalculations = () => {
   const [results, setResults] = useState<RevenueLiftResult | null>(null);
   const [isCalculating, setIsCalculating] = useState(false);

   const calculateRevenueLiftScenario = useCallback(
      (
         scenario: PricingScenario,
         industry: 'saas' | 'agency' | 'infrastructure'
      ): RevenueLiftResult => {
         setIsCalculating(true);
         try {
            const elasticityModel = selectElasticityModel(industry, 'medium');
            const result = calculateRevenueLift(scenario, elasticityModel);
            setResults(result);
            return result;
         } finally {
            setIsCalculating(false);
         }
      },
      []
   );

   const findOptimal = useCallback(
      (
         basePrice: number,
         customers: number,
         elasticity: number,
         range?: { min: number; max: number }
      ): { optimalPrice: number; maxRevenue: number } => {
         setIsCalculating(true);
         try {
            const result = findOptimalPrice(basePrice, customers, elasticity, range);
            return result;
         } finally {
            setIsCalculating(false);
         }
      },
      []
   );

   return {
      results,
      isCalculating,
      calculateRevenueLiftScenario,
      findOptimal,
   };
};

--- src/index.css ---
@import "tailwindcss";

@theme {
  --font-sans: "Inter", ui-sans-serif, system-ui, sans-serif;
}

--- src/main.tsx ---
import { StrictMode } from 'react'
import { createRoot } from 'react-dom/client'
import './index.css'
import App from './App.tsx'

createRoot(document.getElementById('root')!).render(
  <StrictMode>
    <App />
  </StrictMode>,
)

--- src/services/pdfGenerator.ts ---
import jsPDF from 'jspdf';
import 'jspdf-autotable'; // –ò–º–ø–æ—Ä—Ç–∏—Ä—É–µ–º –±–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π, –µ—Å–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —á–µ—Ä–µ–∑ pdf.autoTable()
import type { ReportData } from '../core/types';

export async function generatePricingReport(data: ReportData) {
   const pdf = new jsPDF() as any; // –ò—Å–ø–æ–ª—å–∑—É–µ–º any –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –º–µ—Ç–æ–¥—É autoTable

   // –í–∞—à –∫–æ–¥ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏...
   pdf.autoTable({
      head: [['–ü–∞—Ä–∞–º–µ—Ç—Ä', '–ó–Ω–∞—á–µ–Ω–∏–µ']],
      body: [['–ë—Ä–µ–Ω–¥', data.brandName]],
   });

   pdf.save('report.pdf');
}

--- src/store/appStore.ts ---
// src/store/appStore.ts
import { create } from 'zustand';
import type { AppState } from './types';
import type { PricingData, RevenueLiftResult, PricingPlaybook } from '../core/types';
import type { CSVRow, CSVAnalysisResult } from '../csv/types';

export const useAppStore = create<AppState>((set) => ({
   // ========== –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è ==========
   quickInputData: null,
   csvData: null,
   csvAnalysis: null,
   revenueLiftResults: null,
   inflationImpact: null,
   ltvProjection: null,
   currentTab: 'quick-input',
   isLoading: false,
   error: null,
   selectedPlaybook: null,
   inflationSector: 'IT Services',
   inflationRegion: 'US',

   // ========== –ú–µ—Ç–æ–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã–º–∏ ==========
   setQuickInputData: (data: PricingData | null) =>
      set({ quickInputData: data }),

   setCSVData: (data: CSVRow[] | null) =>
      set({ csvData: data }),

   setCSVAnalysis: (analysis: CSVAnalysisResult | null) =>
      set({ csvAnalysis: analysis }),

   setRevenueLiftResults: (results: RevenueLiftResult | null) =>
      set({ revenueLiftResults: results }),

   setInflationImpact: (impact: any) =>
      set({ inflationImpact: impact }),

   setLTVProjection: (projection: any) =>
      set({ ltvProjection: projection }),

   // ========== –ú–µ—Ç–æ–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è UI ==========
   setCurrentTab: (tab: string) =>
      set({ currentTab: tab }),

   setLoading: (loading: boolean) =>
      set({ isLoading: loading }),

   setError: (error: string | null) =>
      set({ error }),

   // ========== –ú–µ—Ç–æ–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–ª–µ–π–±—É–∫–∞–º–∏ ==========
   setSelectedPlaybook: (playbook: PricingPlaybook | null) =>
      set({ selectedPlaybook: playbook }),

   setInflationSettings: (sector: string, region: string) =>
      set({ inflationSector: sector, inflationRegion: region }),

   // ========== –°–±—Ä–æ—Å —Å–æ—Å—Ç–æ—è–Ω–∏—è ==========
   reset: () =>
      set({
         quickInputData: null,
         csvData: null,
         csvAnalysis: null,
         revenueLiftResults: null,
         inflationImpact: null,
         ltvProjection: null,
         selectedPlaybook: null,
         error: null,
      }),
}));

--- src/store/types.ts ---
// src/store/types.ts
import type {
   PricingPlaybook,
   PricingData,
   RevenueLiftResult,
   CSVAnalysisResult,
} from '../core/types';
import type { CSVRow } from '../csv/types';

export interface AppState {
   // ========== –û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ ==========
   quickInputData: PricingData | null;
   csvData: CSVRow[] | null;
   csvAnalysis: CSVAnalysisResult | null;
   revenueLiftResults: RevenueLiftResult | null;
   inflationImpact: any | null;
   ltvProjection: any | null;

   // ========== UI —Å–æ—Å—Ç–æ—è–Ω–∏–µ ==========
   currentTab: string;
   isLoading: boolean;
   error: string | null;

   // ========== Playbooks & Settings ==========
   selectedPlaybook: PricingPlaybook | null;
   inflationSector: string;
   inflationRegion: string;

   // ========== –ú–µ—Ç–æ–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã–º–∏ ==========
   setQuickInputData: (data: PricingData | null) => void;
   setCSVData: (data: CSVRow[] | null) => void;
   setCSVAnalysis: (analysis: CSVAnalysisResult | null) => void;
   setRevenueLiftResults: (results: RevenueLiftResult | null) => void;
   setInflationImpact: (impact: any) => void;
   setLTVProjection: (projection: any) => void;

   // ========== –ú–µ—Ç–æ–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è UI ==========
   setCurrentTab: (tab: string) => void;
   setLoading: (loading: boolean) => void;
   setError: (error: string | null) => void;

   // ========== –ú–µ—Ç–æ–¥—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–ª–µ–π–±—É–∫–∞–º–∏ ==========
   setSelectedPlaybook: (playbook: PricingPlaybook | null) => void;
   setInflationSettings: (sector: string, region: string) => void;

   // ========== –°–±—Ä–æ—Å ==========
   reset: () => void;
}
